import { getRequestUrlFromQRCodeMessage, getRequestFromJwt } from "./utils";
import { QR_REQUEST_URI_KEY } from "./constants";

describe("test utils", () => {
  it("getRequestUrlFromQRCode", async () => {
    const expectedRequestUrl =
      "https%3A%2F%2F5a8b-39-110-214-139.ngrok.io%2Fissue-request.jwt%3Fid%3DVhGPvOWWiFmGRrMfAnLMsqvSPKImqpe9";
    const qrcodeMessage = `${QR_REQUEST_URI_KEY}=${expectedRequestUrl}`;
    const requestUrl = getRequestUrlFromQRCodeMessage(qrcodeMessage);
    expect(encodeURIComponent(requestUrl)).toBe(expectedRequestUrl);
  });

  it("getRequestFromUrl", async () => {
    const requestDataInJwt =
      "eyJ0eXAiOiJKV1QiLCJraWQiOiJkaWQ6aW9uOkVpQVVlQXlTcmMxcWdQdWNMWUlfeXRmdWRUOGJGeFVFVE5vbHp6NFBDZHkxYnc6ZXlKa1pXeDBZU0k2ZXlKd1lYUmphR1Z6SWpwYmV5SmhZM1JwYjI0aU9pSnlaWEJzWVdObElpd2laRzlqZFcxbGJuUWlPbnNpY0hWaWJHbGpTMlY1Y3lJNlczc2lhV1FpT2lKemFXZGZNalJpWWpNd056UWlMQ0p3ZFdKc2FXTkxaWGxLZDJzaU9uc2lZM0oySWpvaWMyVmpjREkxTm1zeElpd2lhM1I1SWpvaVJVTWlMQ0o0SWpvaVJEbHFZVWd3VVRGUFpXMVhZVlZmZUd0bVJ6QkpPVm95WW5jdE9GZExVRkYyVFd0MkxXdGtkak54VVNJc0lua2lPaUpQY2xWVVN6QktTV04wVW5GUVRIUkNRbFF4U1c1aU1UZFpTMjlzU0ZKdlgxa3lTMFpmYjNZeU1FVjNJbjBzSW5CMWNuQnZjMlZ6SWpwYkltRjFkR2hsYm5ScFkyRjBhVzl1SWl3aVlYTnpaWEowYVc5dVRXVjBhRzlrSWwwc0luUjVjR1VpT2lKRlkyUnpZVk5sWTNBeU5UWnJNVlpsY21sbWFXTmhkR2x2Ymt0bGVUSXdNVGtpZlYwc0luTmxjblpwWTJWeklqcGJleUpwWkNJNklteHBibXRsWkdSdmJXRnBibk1pTENKelpYSjJhV05sUlc1a2NHOXBiblFpT25zaWIzSnBaMmx1Y3lJNld5Sm9kSFJ3Y3pvdkwyUnBaQzUzYjI5a1ozSnZkbVZrWlcxdkxtTnZiUzhpWFgwc0luUjVjR1VpT2lKTWFXNXJaV1JFYjIxaGFXNXpJbjFkZlgxZExDSjFjR1JoZEdWRGIyMXRhWFJ0Wlc1MElqb2lSV2xCZVdGMVRWZ3pSV3RCY1VnMlJWRlVVRXc0U21RNGFsVnZZalpYZGxack5VcFNhbWRvZEVWWVdIaERRU0o5TENKemRXWm1hWGhFWVhSaElqcDdJbVJsYkhSaFNHRnphQ0k2SWtWcFExTnZhalZxU2xOT1VqQktVMHROWkVKMVkyUnVNbGg1VTJaYVluZFdWbE5JV1VOclJFbGxUSFY1Tm5jaUxDSnlaV052ZG1WeWVVTnZiVzFwZEcxbGJuUWlPaUpGYVVSNFltMUVMVFE1Y0VGd01EQlBha2Q2Vlhkb05uWTVaakI1Y25SaWFVNVRiWEEzZGxkd2JUUkVWSHBCSW4xOSNzaWdfMjRiYjMwNzQiLCJhbGciOiJFUzI1NksifQ.eyJyZXNwb25zZV90eXBlIjoiaWRfdG9rZW4iLCJyZXNwb25zZV9tb2RlIjoiZm9ybV9wb3N0Iiwic2NvcGUiOiJvcGVuaWQgZGlkX2F1dGhuIiwic3RhdGUiOiI5NWJkaGVFZWRaeTNvbV83ODZLQ1VXWTJ0clhNTjZpcSIsIm5vbmNlIjoidVRnX3J6VWo4eV85TkEiLCJpc3MiOiJkaWQ6aW9uOkVpQVVlQXlTcmMxcWdQdWNMWUlfeXRmdWRUOGJGeFVFVE5vbHp6NFBDZHkxYnc6ZXlKa1pXeDBZU0k2ZXlKd1lYUmphR1Z6SWpwYmV5SmhZM1JwYjI0aU9pSnlaWEJzWVdObElpd2laRzlqZFcxbGJuUWlPbnNpY0hWaWJHbGpTMlY1Y3lJNlczc2lhV1FpT2lKemFXZGZNalJpWWpNd056UWlMQ0p3ZFdKc2FXTkxaWGxLZDJzaU9uc2lZM0oySWpvaWMyVmpjREkxTm1zeElpd2lhM1I1SWpvaVJVTWlMQ0o0SWpvaVJEbHFZVWd3VVRGUFpXMVhZVlZmZUd0bVJ6QkpPVm95WW5jdE9GZExVRkYyVFd0MkxXdGtkak54VVNJc0lua2lPaUpQY2xWVVN6QktTV04wVW5GUVRIUkNRbFF4U1c1aU1UZFpTMjlzU0ZKdlgxa3lTMFpmYjNZeU1FVjNJbjBzSW5CMWNuQnZjMlZ6SWpwYkltRjFkR2hsYm5ScFkyRjBhVzl1SWl3aVlYTnpaWEowYVc5dVRXVjBhRzlrSWwwc0luUjVjR1VpT2lKRlkyUnpZVk5sWTNBeU5UWnJNVlpsY21sbWFXTmhkR2x2Ymt0bGVUSXdNVGtpZlYwc0luTmxjblpwWTJWeklqcGJleUpwWkNJNklteHBibXRsWkdSdmJXRnBibk1pTENKelpYSjJhV05sUlc1a2NHOXBiblFpT25zaWIzSnBaMmx1Y3lJNld5Sm9kSFJ3Y3pvdkwyUnBaQzUzYjI5a1ozSnZkbVZrWlcxdkxtTnZiUzhpWFgwc0luUjVjR1VpT2lKTWFXNXJaV1JFYjIxaGFXNXpJbjFkZlgxZExDSjFjR1JoZEdWRGIyMXRhWFJ0Wlc1MElqb2lSV2xCZVdGMVRWZ3pSV3RCY1VnMlJWRlVVRXc0U21RNGFsVnZZalpYZGxack5VcFNhbWRvZEVWWVdIaERRU0o5TENKemRXWm1hWGhFWVhSaElqcDdJbVJsYkhSaFNHRnphQ0k2SWtWcFExTnZhalZxU2xOT1VqQktVMHROWkVKMVkyUnVNbGg1VTJaYVluZFdWbE5JV1VOclJFbGxUSFY1Tm5jaUxDSnlaV052ZG1WeWVVTnZiVzFwZEcxbGJuUWlPaUpGYVVSNFltMUVMVFE1Y0VGd01EQlBha2Q2Vlhkb05uWTVaakI1Y25SaWFVNVRiWEEzZGxkd2JUUkVWSHBCSW4xOSIsInJlZ2lzdHJhdGlvbiI6e30sImlhdCI6MTYzMzQxNDY4MSwiZXhwIjoxNjMzNDE0OTgxLCJwcm9tcHQiOiJjcmVhdGUiLCJwcmVzZW50YXRpb25fZGVmaW5pdGlvbiI6eyJpbnB1dF9kZXNjcmlwdG9ycyI6W3siaWQiOiJleHBlcnQiLCJzY2hlbWEiOnsidXJpIjpbIlZlcmlmaWVkQ3JlZGVudGlhbEV4cGVydCJdfSwiaXNzdWFuY2UiOlt7Im1hbmlmZXN0IjoiaHR0cHM6Ly9iZXRhLmRpZC5tc2lkZW50aXR5LmNvbS92MS4wLzNjMzJlZDQwLThhMTAtNDY1Yi04YmE0LTBiMWU4Njg4MjY2OC92ZXJpZmlhYmxlQ3JlZGVudGlhbC9jb250cmFjdHMvVmVyaWZpZWRDcmVkZW50aWFsRXhwZXJ0In1dfV19LCJuYmYiOjE2MzM0MTQ2ODEsImp0aSI6ImYzNTEwYzNmLTJhYzUtNDUxMS1hMTMwLTQ5ZjJkODk3ZGQ0MiJ9.yNPXrTIzGw3Zp-VN1t5wt7PTKriOe1rIdFF4EKDbh7LtBPDmnG5vW17tuExdAWyCKCGfLg8TEu921KOUz884BA";
    const request = await getRequestFromJwt(requestDataInJwt);
    console.log(request);
  });
});
