{"ast":null,"code":"var inherits=require('inherits');var asn1=require(\"../../asn1\");var base=asn1.base;var bignum=asn1.bignum;var der=asn1.constants.der;function DERDecoder(entity){this.enc='der';this.name=entity.name;this.entity=entity;this.tree=new DERNode();this.tree._init(entity.body);};module.exports=DERDecoder;DERDecoder.prototype.decode=function decode(data,options){if(!(data instanceof base.DecoderBuffer))data=new base.DecoderBuffer(data,options);return this.tree._decode(data,options);};function DERNode(parent){base.Node.call(this,'der',parent);}inherits(DERNode,base.Node);DERNode.prototype._peekTag=function peekTag(buffer,tag,any){if(buffer.isEmpty())return false;var state=buffer.save();var decodedTag=derDecodeTag(buffer,'Failed to peek tag: \"'+tag+'\"');if(buffer.isError(decodedTag))return decodedTag;buffer.restore(state);return decodedTag.tag===tag||decodedTag.tagStr===tag||decodedTag.tagStr+'of'===tag||any;};DERNode.prototype._decodeTag=function decodeTag(buffer,tag,any){var decodedTag=derDecodeTag(buffer,'Failed to decode tag of \"'+tag+'\"');if(buffer.isError(decodedTag))return decodedTag;var len=derDecodeLen(buffer,decodedTag.primitive,'Failed to get length of \"'+tag+'\"');if(buffer.isError(len))return len;if(!any&&decodedTag.tag!==tag&&decodedTag.tagStr!==tag&&decodedTag.tagStr+'of'!==tag){return buffer.error('Failed to match tag: \"'+tag+'\"');}if(decodedTag.primitive||len!==null)return buffer.skip(len,'Failed to match body of: \"'+tag+'\"');var state=buffer.save();var res=this._skipUntilEnd(buffer,'Failed to skip indefinite length body: \"'+this.tag+'\"');if(buffer.isError(res))return res;len=buffer.offset-state.offset;buffer.restore(state);return buffer.skip(len,'Failed to match body of: \"'+tag+'\"');};DERNode.prototype._skipUntilEnd=function skipUntilEnd(buffer,fail){while(true){var tag=derDecodeTag(buffer,fail);if(buffer.isError(tag))return tag;var len=derDecodeLen(buffer,tag.primitive,fail);if(buffer.isError(len))return len;var res;if(tag.primitive||len!==null)res=buffer.skip(len);else res=this._skipUntilEnd(buffer,fail);if(buffer.isError(res))return res;if(tag.tagStr==='end')break;}};DERNode.prototype._decodeList=function decodeList(buffer,tag,decoder,options){var result=[];while(!buffer.isEmpty()){var possibleEnd=this._peekTag(buffer,'end');if(buffer.isError(possibleEnd))return possibleEnd;var res=decoder.decode(buffer,'der',options);if(buffer.isError(res)&&possibleEnd)break;result.push(res);}return result;};DERNode.prototype._decodeStr=function decodeStr(buffer,tag){if(tag==='bitstr'){var unused=buffer.readUInt8();if(buffer.isError(unused))return unused;return{unused:unused,data:buffer.raw()};}else if(tag==='bmpstr'){var raw=buffer.raw();if(raw.length%2===1)return buffer.error('Decoding of string type: bmpstr length mismatch');var str='';for(var i=0;i<raw.length/2;i++){str+=String.fromCharCode(raw.readUInt16BE(i*2));}return str;}else if(tag==='numstr'){var numstr=buffer.raw().toString('ascii');if(!this._isNumstr(numstr)){return buffer.error('Decoding of string type: '+'numstr unsupported characters');}return numstr;}else if(tag==='octstr'){return buffer.raw();}else if(tag==='objDesc'){return buffer.raw();}else if(tag==='printstr'){var printstr=buffer.raw().toString('ascii');if(!this._isPrintstr(printstr)){return buffer.error('Decoding of string type: '+'printstr unsupported characters');}return printstr;}else if(/str$/.test(tag)){return buffer.raw().toString();}else{return buffer.error('Decoding of string type: '+tag+' unsupported');}};DERNode.prototype._decodeObjid=function decodeObjid(buffer,values,relative){var result;var identifiers=[];var ident=0;while(!buffer.isEmpty()){var subident=buffer.readUInt8();ident<<=7;ident|=subident&0x7f;if((subident&0x80)===0){identifiers.push(ident);ident=0;}}if(subident&0x80)identifiers.push(ident);var first=identifiers[0]/40|0;var second=identifiers[0]%40;if(relative)result=identifiers;else result=[first,second].concat(identifiers.slice(1));if(values){var tmp=values[result.join(' ')];if(tmp===undefined)tmp=values[result.join('.')];if(tmp!==undefined)result=tmp;}return result;};DERNode.prototype._decodeTime=function decodeTime(buffer,tag){var str=buffer.raw().toString();if(tag==='gentime'){var year=str.slice(0,4)|0;var mon=str.slice(4,6)|0;var day=str.slice(6,8)|0;var hour=str.slice(8,10)|0;var min=str.slice(10,12)|0;var sec=str.slice(12,14)|0;}else if(tag==='utctime'){var year=str.slice(0,2)|0;var mon=str.slice(2,4)|0;var day=str.slice(4,6)|0;var hour=str.slice(6,8)|0;var min=str.slice(8,10)|0;var sec=str.slice(10,12)|0;if(year<70)year=2000+year;else year=1900+year;}else{return buffer.error('Decoding '+tag+' time is not supported yet');}return Date.UTC(year,mon-1,day,hour,min,sec,0);};DERNode.prototype._decodeNull=function decodeNull(buffer){return null;};DERNode.prototype._decodeBool=function decodeBool(buffer){var res=buffer.readUInt8();if(buffer.isError(res))return res;else return res!==0;};DERNode.prototype._decodeInt=function decodeInt(buffer,values){var raw=buffer.raw();var res=new bignum(raw);if(values)res=values[res.toString(10)]||res;return res;};DERNode.prototype._use=function use(entity,obj){if(typeof entity==='function')entity=entity(obj);return entity._getDecoder('der').tree;};function derDecodeTag(buf,fail){var tag=buf.readUInt8(fail);if(buf.isError(tag))return tag;var cls=der.tagClass[tag>>6];var primitive=(tag&0x20)===0;if((tag&0x1f)===0x1f){var oct=tag;tag=0;while((oct&0x80)===0x80){oct=buf.readUInt8(fail);if(buf.isError(oct))return oct;tag<<=7;tag|=oct&0x7f;}}else{tag&=0x1f;}var tagStr=der.tag[tag];return{cls:cls,primitive:primitive,tag:tag,tagStr:tagStr};}function derDecodeLen(buf,primitive,fail){var len=buf.readUInt8(fail);if(buf.isError(len))return len;if(!primitive&&len===0x80)return null;if((len&0x80)===0){return len;}var num=len&0x7f;if(num>4)return buf.error('length octect is too long');len=0;for(var i=0;i<num;i++){len<<=8;var j=buf.readUInt8(fail);if(buf.isError(j))return j;len|=j;}return len;}","map":{"version":3,"sources":["/Users/naohirofujie/.anyenv/envs/nodenv/versions/14.5.0/lib/node_modules/expo-cli/node_modules/asn1.js/lib/asn1/decoders/der.js"],"names":["inherits","require","asn1","base","bignum","der","constants","DERDecoder","entity","enc","name","tree","DERNode","_init","body","module","exports","prototype","decode","data","options","DecoderBuffer","_decode","parent","Node","call","_peekTag","peekTag","buffer","tag","any","isEmpty","state","save","decodedTag","derDecodeTag","isError","restore","tagStr","_decodeTag","decodeTag","len","derDecodeLen","primitive","error","skip","res","_skipUntilEnd","offset","skipUntilEnd","fail","_decodeList","decodeList","decoder","result","possibleEnd","push","_decodeStr","decodeStr","unused","readUInt8","raw","length","str","i","String","fromCharCode","readUInt16BE","numstr","toString","_isNumstr","printstr","_isPrintstr","test","_decodeObjid","decodeObjid","values","relative","identifiers","ident","subident","first","second","concat","slice","tmp","join","undefined","_decodeTime","decodeTime","year","mon","day","hour","min","sec","Date","UTC","_decodeNull","decodeNull","_decodeBool","decodeBool","_decodeInt","decodeInt","_use","use","obj","_getDecoder","buf","cls","tagClass","oct","num","j"],"mappings":"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","sourcesContent":["var inherits = require('inherits');\n\nvar asn1 = require('../../asn1');\nvar base = asn1.base;\nvar bignum = asn1.bignum;\n\n// Import DER constants\nvar der = asn1.constants.der;\n\nfunction DERDecoder(entity) {\n  this.enc = 'der';\n  this.name = entity.name;\n  this.entity = entity;\n\n  // Construct base tree\n  this.tree = new DERNode();\n  this.tree._init(entity.body);\n};\nmodule.exports = DERDecoder;\n\nDERDecoder.prototype.decode = function decode(data, options) {\n  if (!(data instanceof base.DecoderBuffer))\n    data = new base.DecoderBuffer(data, options);\n\n  return this.tree._decode(data, options);\n};\n\n// Tree methods\n\nfunction DERNode(parent) {\n  base.Node.call(this, 'der', parent);\n}\ninherits(DERNode, base.Node);\n\nDERNode.prototype._peekTag = function peekTag(buffer, tag, any) {\n  if (buffer.isEmpty())\n    return false;\n\n  var state = buffer.save();\n  var decodedTag = derDecodeTag(buffer, 'Failed to peek tag: \"' + tag + '\"');\n  if (buffer.isError(decodedTag))\n    return decodedTag;\n\n  buffer.restore(state);\n\n  return decodedTag.tag === tag || decodedTag.tagStr === tag ||\n    (decodedTag.tagStr + 'of') === tag || any;\n};\n\nDERNode.prototype._decodeTag = function decodeTag(buffer, tag, any) {\n  var decodedTag = derDecodeTag(buffer,\n                                'Failed to decode tag of \"' + tag + '\"');\n  if (buffer.isError(decodedTag))\n    return decodedTag;\n\n  var len = derDecodeLen(buffer,\n                         decodedTag.primitive,\n                         'Failed to get length of \"' + tag + '\"');\n\n  // Failure\n  if (buffer.isError(len))\n    return len;\n\n  if (!any &&\n      decodedTag.tag !== tag &&\n      decodedTag.tagStr !== tag &&\n      decodedTag.tagStr + 'of' !== tag) {\n    return buffer.error('Failed to match tag: \"' + tag + '\"');\n  }\n\n  if (decodedTag.primitive || len !== null)\n    return buffer.skip(len, 'Failed to match body of: \"' + tag + '\"');\n\n  // Indefinite length... find END tag\n  var state = buffer.save();\n  var res = this._skipUntilEnd(\n      buffer,\n      'Failed to skip indefinite length body: \"' + this.tag + '\"');\n  if (buffer.isError(res))\n    return res;\n\n  len = buffer.offset - state.offset;\n  buffer.restore(state);\n  return buffer.skip(len, 'Failed to match body of: \"' + tag + '\"');\n};\n\nDERNode.prototype._skipUntilEnd = function skipUntilEnd(buffer, fail) {\n  while (true) {\n    var tag = derDecodeTag(buffer, fail);\n    if (buffer.isError(tag))\n      return tag;\n    var len = derDecodeLen(buffer, tag.primitive, fail);\n    if (buffer.isError(len))\n      return len;\n\n    var res;\n    if (tag.primitive || len !== null)\n      res = buffer.skip(len)\n    else\n      res = this._skipUntilEnd(buffer, fail);\n\n    // Failure\n    if (buffer.isError(res))\n      return res;\n\n    if (tag.tagStr === 'end')\n      break;\n  }\n};\n\nDERNode.prototype._decodeList = function decodeList(buffer, tag, decoder,\n                                                    options) {\n  var result = [];\n  while (!buffer.isEmpty()) {\n    var possibleEnd = this._peekTag(buffer, 'end');\n    if (buffer.isError(possibleEnd))\n      return possibleEnd;\n\n    var res = decoder.decode(buffer, 'der', options);\n    if (buffer.isError(res) && possibleEnd)\n      break;\n    result.push(res);\n  }\n  return result;\n};\n\nDERNode.prototype._decodeStr = function decodeStr(buffer, tag) {\n  if (tag === 'bitstr') {\n    var unused = buffer.readUInt8();\n    if (buffer.isError(unused))\n      return unused;\n    return { unused: unused, data: buffer.raw() };\n  } else if (tag === 'bmpstr') {\n    var raw = buffer.raw();\n    if (raw.length % 2 === 1)\n      return buffer.error('Decoding of string type: bmpstr length mismatch');\n\n    var str = '';\n    for (var i = 0; i < raw.length / 2; i++) {\n      str += String.fromCharCode(raw.readUInt16BE(i * 2));\n    }\n    return str;\n  } else if (tag === 'numstr') {\n    var numstr = buffer.raw().toString('ascii');\n    if (!this._isNumstr(numstr)) {\n      return buffer.error('Decoding of string type: ' +\n                          'numstr unsupported characters');\n    }\n    return numstr;\n  } else if (tag === 'octstr') {\n    return buffer.raw();\n  } else if (tag === 'objDesc') {\n    return buffer.raw();\n  } else if (tag === 'printstr') {\n    var printstr = buffer.raw().toString('ascii');\n    if (!this._isPrintstr(printstr)) {\n      return buffer.error('Decoding of string type: ' +\n                          'printstr unsupported characters');\n    }\n    return printstr;\n  } else if (/str$/.test(tag)) {\n    return buffer.raw().toString();\n  } else {\n    return buffer.error('Decoding of string type: ' + tag + ' unsupported');\n  }\n};\n\nDERNode.prototype._decodeObjid = function decodeObjid(buffer, values, relative) {\n  var result;\n  var identifiers = [];\n  var ident = 0;\n  while (!buffer.isEmpty()) {\n    var subident = buffer.readUInt8();\n    ident <<= 7;\n    ident |= subident & 0x7f;\n    if ((subident & 0x80) === 0) {\n      identifiers.push(ident);\n      ident = 0;\n    }\n  }\n  if (subident & 0x80)\n    identifiers.push(ident);\n\n  var first = (identifiers[0] / 40) | 0;\n  var second = identifiers[0] % 40;\n\n  if (relative)\n    result = identifiers;\n  else\n    result = [first, second].concat(identifiers.slice(1));\n\n  if (values) {\n    var tmp = values[result.join(' ')];\n    if (tmp === undefined)\n      tmp = values[result.join('.')];\n    if (tmp !== undefined)\n      result = tmp;\n  }\n\n  return result;\n};\n\nDERNode.prototype._decodeTime = function decodeTime(buffer, tag) {\n  var str = buffer.raw().toString();\n  if (tag === 'gentime') {\n    var year = str.slice(0, 4) | 0;\n    var mon = str.slice(4, 6) | 0;\n    var day = str.slice(6, 8) | 0;\n    var hour = str.slice(8, 10) | 0;\n    var min = str.slice(10, 12) | 0;\n    var sec = str.slice(12, 14) | 0;\n  } else if (tag === 'utctime') {\n    var year = str.slice(0, 2) | 0;\n    var mon = str.slice(2, 4) | 0;\n    var day = str.slice(4, 6) | 0;\n    var hour = str.slice(6, 8) | 0;\n    var min = str.slice(8, 10) | 0;\n    var sec = str.slice(10, 12) | 0;\n    if (year < 70)\n      year = 2000 + year;\n    else\n      year = 1900 + year;\n  } else {\n    return buffer.error('Decoding ' + tag + ' time is not supported yet');\n  }\n\n  return Date.UTC(year, mon - 1, day, hour, min, sec, 0);\n};\n\nDERNode.prototype._decodeNull = function decodeNull(buffer) {\n  return null;\n};\n\nDERNode.prototype._decodeBool = function decodeBool(buffer) {\n  var res = buffer.readUInt8();\n  if (buffer.isError(res))\n    return res;\n  else\n    return res !== 0;\n};\n\nDERNode.prototype._decodeInt = function decodeInt(buffer, values) {\n  // Bigint, return as it is (assume big endian)\n  var raw = buffer.raw();\n  var res = new bignum(raw);\n\n  if (values)\n    res = values[res.toString(10)] || res;\n\n  return res;\n};\n\nDERNode.prototype._use = function use(entity, obj) {\n  if (typeof entity === 'function')\n    entity = entity(obj);\n  return entity._getDecoder('der').tree;\n};\n\n// Utility methods\n\nfunction derDecodeTag(buf, fail) {\n  var tag = buf.readUInt8(fail);\n  if (buf.isError(tag))\n    return tag;\n\n  var cls = der.tagClass[tag >> 6];\n  var primitive = (tag & 0x20) === 0;\n\n  // Multi-octet tag - load\n  if ((tag & 0x1f) === 0x1f) {\n    var oct = tag;\n    tag = 0;\n    while ((oct & 0x80) === 0x80) {\n      oct = buf.readUInt8(fail);\n      if (buf.isError(oct))\n        return oct;\n\n      tag <<= 7;\n      tag |= oct & 0x7f;\n    }\n  } else {\n    tag &= 0x1f;\n  }\n  var tagStr = der.tag[tag];\n\n  return {\n    cls: cls,\n    primitive: primitive,\n    tag: tag,\n    tagStr: tagStr\n  };\n}\n\nfunction derDecodeLen(buf, primitive, fail) {\n  var len = buf.readUInt8(fail);\n  if (buf.isError(len))\n    return len;\n\n  // Indefinite form\n  if (!primitive && len === 0x80)\n    return null;\n\n  // Definite form\n  if ((len & 0x80) === 0) {\n    // Short form\n    return len;\n  }\n\n  // Long form\n  var num = len & 0x7f;\n  if (num > 4)\n    return buf.error('length octect is too long');\n\n  len = 0;\n  for (var i = 0; i < num; i++) {\n    len <<= 8;\n    var j = buf.readUInt8(fail);\n    if (buf.isError(j))\n      return j;\n    len |= j;\n  }\n\n  return len;\n}\n"]},"metadata":{},"sourceType":"script"}