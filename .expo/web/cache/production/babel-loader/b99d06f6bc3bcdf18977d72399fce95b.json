{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import*as Linking from\"expo-linking\";import{useFonts,NotoSansJP_400Regular,NotoSansJP_700Bold}from\"@expo-google-fonts/noto-sans-jp\";import*as React from\"react\";import Platform from\"react-native-web/dist/exports/Platform\";import AsyncStorage from\"@react-native-community/async-storage\";import axios from\"axios\";import{generatePrivateKey,jwt}from\"../modules\";export var appendCorsAnywhere=function appendCorsAnywhere(os,url){return os===\"web\"?\"https://cors-anywhere.herokuapp.com/\"+url:url;};export var initializeApp=function initializeApp(){var _React$useState=React.useState(\"\"),_React$useState2=_slicedToArray(_React$useState,2),privateKeyState=_React$useState2[0],setPrivateKeyState=_React$useState2[1];var _React$useState3=React.useState(\"\"),_React$useState4=_slicedToArray(_React$useState3,2),screenState=_React$useState4[0],setScreenState=_React$useState4[1];var _useFonts=useFonts({NotoSansJP_400Regular:NotoSansJP_400Regular,NotoSansJP_700Bold:NotoSansJP_700Bold}),_useFonts2=_slicedToArray(_useFonts,1),isFontsLoaded=_useFonts2[0];var loadPrivateKeyAsync=function loadPrivateKeyAsync(){var privateKey;return _regeneratorRuntime.async(function loadPrivateKeyAsync$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return _regeneratorRuntime.awrap(AsyncStorage.getItem(\"@private_key\"));case 2:privateKey=_context.sent;if(!privateKey){privateKey=generatePrivateKey();AsyncStorage.setItem(\"@private_key\",privateKey);}setPrivateKeyState(privateKey);case 5:case\"end\":return _context.stop();}}},null,null,null,Promise);};var loadScreenAsync=function loadScreenAsync(){var initialUrl,_Linking$parse,queryParams,requestResponse,request,decodedRequest,manifestUri,manifestResponse,manifest;return _regeneratorRuntime.async(function loadScreenAsync$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return _regeneratorRuntime.awrap(Linking.getInitialURL());case 2:initialUrl=_context2.sent;if(initialUrl){_context2.next=5;break;}return _context2.abrupt(\"return\");case 5:_Linking$parse=Linking.parse(initialUrl),queryParams=_Linking$parse.queryParams;if(!(!queryParams||Object.keys(queryParams).length===0)){_context2.next=9;break;}setScreenState(\"Home\");return _context2.abrupt(\"return\");case 9:if(!queryParams.request_uri){_context2.next=31;break;}_context2.next=12;return _regeneratorRuntime.awrap(axios.get(appendCorsAnywhere(Platform.OS,queryParams.request_uri)));case 12:requestResponse=_context2.sent;request=requestResponse.data;decodedRequest=jwt.decode(request);_context2.next=17;return _regeneratorRuntime.awrap(AsyncStorage.setItem(\"@request\",JSON.stringify(decodedRequest)));case 17:if(!(decodedRequest.prompt===\"create\")){_context2.next=29;break;}_context2.next=20;return _regeneratorRuntime.awrap(AsyncStorage.setItem(\"@mode\",\"receive\"));case 20:manifestUri=decodedRequest.presentation_definition.input_descriptors[0].issuance[0].manifest;_context2.next=23;return _regeneratorRuntime.awrap(axios.get(appendCorsAnywhere(Platform.OS,manifestUri)));case 23:manifestResponse=_context2.sent;manifest=manifestResponse.data;_context2.next=27;return _regeneratorRuntime.awrap(AsyncStorage.setItem(\"@manifest\",JSON.stringify(manifest)));case 27:_context2.next=31;break;case 29:_context2.next=31;return _regeneratorRuntime.awrap(AsyncStorage.setItem(\"@mode\",\"present\"));case 31:setScreenState(\"Response\");case 32:case\"end\":return _context2.stop();}}},null,null,null,Promise);};React.useEffect(function(){loadPrivateKeyAsync();loadScreenAsync();},[]);return{isFontsLoaded:isFontsLoaded,privateKeyState:privateKeyState,screenState:screenState};};export var initializeResponse=function initializeResponse(){var _React$useState5=React.useState(\"\"),_React$useState6=_slicedToArray(_React$useState5,2),modeState=_React$useState6[0],setModeState=_React$useState6[1];var _React$useState7=React.useState(),_React$useState8=_slicedToArray(_React$useState7,2),requestState=_React$useState8[0],setRequestState=_React$useState8[1];var _React$useState9=React.useState(),_React$useState10=_slicedToArray(_React$useState9,2),manifestState=_React$useState10[0],setManifestState=_React$useState10[1];var _React$useState11=React.useState(),_React$useState12=_slicedToArray(_React$useState11,2),presentaionManifestState=_React$useState12[0],setPresentaionManifestState=_React$useState12[1];var _React$useState13=React.useState(\"\"),_React$useState14=_slicedToArray(_React$useState13,2),idTokenState=_React$useState14[0],setIdTokenState=_React$useState14[1];var _React$useState15=React.useState(),_React$useState16=_slicedToArray(_React$useState15,2),vcState=_React$useState16[0],setVcState=_React$useState16[1];React.useEffect(function(){(function _callee(){var initialUrl,_Linking$parse2,queryParams,manifestString,manifest,openIdConfigurationResponse,openIdConfiguration,tokenResponse,idToken,presentationManifest,presentationManifestResponse,mode,requestString,request,vcString,key,vc;return _regeneratorRuntime.async(function _callee$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return _regeneratorRuntime.awrap(Linking.getInitialURL());case 2:initialUrl=_context3.sent;if(initialUrl){_context3.next=5;break;}return _context3.abrupt(\"return\");case 5:_Linking$parse2=Linking.parse(initialUrl),queryParams=_Linking$parse2.queryParams;if(!(!queryParams||Object.keys(queryParams).length===0)){_context3.next=8;break;}return _context3.abrupt(\"return\");case 8:_context3.next=10;return _regeneratorRuntime.awrap(AsyncStorage.getItem(\"@manifest\"));case 10:manifestString=_context3.sent;if(manifestString){_context3.next=13;break;}return _context3.abrupt(\"return\");case 13:manifest=JSON.parse(manifestString);setManifestState(manifest);if(!queryParams.code){_context3.next=25;break;}_context3.next=18;return _regeneratorRuntime.awrap(axios.get(manifest.input.attestations.idTokens[0].configuration));case 18:openIdConfigurationResponse=_context3.sent;openIdConfiguration=openIdConfigurationResponse.data;_context3.next=22;return _regeneratorRuntime.awrap(axios.get(openIdConfiguration.token_endpoint+\"&grant_type=authorization_code&code=\"+queryParams.code));case 22:tokenResponse=_context3.sent;idToken=tokenResponse.data.id_token;setIdTokenState(idToken);case 25:if(!manifest.input.attestations.presentations){_context3.next=31;break;}_context3.next=28;return _regeneratorRuntime.awrap(axios.get(manifest.input.attestations.presentations[0].contracts[0]));case 28:presentationManifestResponse=_context3.sent;presentationManifest=presentationManifestResponse.data;setPresentaionManifestState(presentationManifest);case 31:_context3.next=33;return _regeneratorRuntime.awrap(AsyncStorage.getItem(\"@mode\"));case 33:mode=_context3.sent;if(mode){_context3.next=36;break;}return _context3.abrupt(\"return\");case 36:setModeState(mode);_context3.next=39;return _regeneratorRuntime.awrap(AsyncStorage.getItem(\"@request\"));case 39:requestString=_context3.sent;if(requestString){_context3.next=42;break;}return _context3.abrupt(\"return\");case 42:request=JSON.parse(requestString);setRequestState(request);_context3.next=46;return _regeneratorRuntime.awrap(AsyncStorage.getItem(\"@vc\"));case 46:vcString=_context3.sent;if(vcString&&(presentationManifest||mode===\"present\")){if(mode===\"present\"){key=request.presentation_definition.input_descriptors[0].schema.uri[0];}else if(mode===\"receive\"){key=manifest.input.attestations.presentations[0].credentialType;}vc=JSON.parse(vcString);setVcState(vc[key]);}case 48:case\"end\":return _context3.stop();}}},null,null,null,Promise);})();},[]);return{manifestState:manifestState,requestState:requestState,modeState:modeState,idTokenState:idTokenState,vcState:vcState,presentaionManifestState:presentaionManifestState};};export var initializeHome=function initializeHome(){var _React$useState17=React.useState(),_React$useState18=_slicedToArray(_React$useState17,2),vcState=_React$useState18[0],setVcState=_React$useState18[1];React.useEffect(function(){(function _callee2(){var vcString,vc;return _regeneratorRuntime.async(function _callee2$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return _regeneratorRuntime.awrap(AsyncStorage.getItem(\"@vc\"));case 2:vcString=_context4.sent;if(vcString){_context4.next=5;break;}return _context4.abrupt(\"return\");case 5:vc=JSON.parse(vcString);setVcState(vc);case 7:case\"end\":return _context4.stop();}}},null,null,null,Promise);})();},[]);return{vcState:vcState};};","map":{"version":3,"sources":["/Users/naohirofujie/Develop/MSVC/bbwallet/browser-wallet/wallet/hooks/index.ts"],"names":["Linking","useFonts","NotoSansJP_400Regular","NotoSansJP_700Bold","React","AsyncStorage","axios","generatePrivateKey","jwt","appendCorsAnywhere","os","url","initializeApp","useState","privateKeyState","setPrivateKeyState","screenState","setScreenState","isFontsLoaded","loadPrivateKeyAsync","getItem","privateKey","setItem","loadScreenAsync","getInitialURL","initialUrl","parse","queryParams","Object","keys","length","request_uri","get","Platform","OS","requestResponse","request","data","decodedRequest","decode","JSON","stringify","prompt","manifestUri","presentation_definition","input_descriptors","issuance","manifest","manifestResponse","useEffect","initializeResponse","modeState","setModeState","requestState","setRequestState","manifestState","setManifestState","presentaionManifestState","setPresentaionManifestState","idTokenState","setIdTokenState","vcState","setVcState","manifestString","code","input","attestations","idTokens","configuration","openIdConfigurationResponse","openIdConfiguration","token_endpoint","tokenResponse","idToken","id_token","presentations","contracts","presentationManifestResponse","presentationManifest","mode","requestString","vcString","key","schema","uri","credentialType","vc","initializeHome"],"mappings":"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","sourcesContent":["import * as Linking from \"expo-linking\";\nimport {\n  useFonts,\n  NotoSansJP_400Regular,\n  NotoSansJP_700Bold,\n} from \"@expo-google-fonts/noto-sans-jp\";\nimport * as React from \"react\";\nimport { Platform } from \"react-native\";\nimport AsyncStorage from \"@react-native-community/async-storage\";\n\nimport axios from \"axios\";\n\nimport { generatePrivateKey, jwt } from \"../modules\";\n\nexport const appendCorsAnywhere = (os, url) => {\n  return os === \"web\" ? `https://cors-anywhere.herokuapp.com/${url}` : url;\n};\n\nexport const initializeApp = () => {\n  const [privateKeyState, setPrivateKeyState] = React.useState(\"\");\n  const [screenState, setScreenState] = React.useState(\"\");\n\n  const [isFontsLoaded] = useFonts({\n    NotoSansJP_400Regular,\n    NotoSansJP_700Bold,\n  });\n\n  const loadPrivateKeyAsync = async () => {\n    let privateKey = await AsyncStorage.getItem(\"@private_key\");\n    if (!privateKey) {\n      privateKey = generatePrivateKey();\n      AsyncStorage.setItem(\"@private_key\", privateKey);\n    }\n    setPrivateKeyState(privateKey);\n  };\n\n  const loadScreenAsync = async () => {\n    const initialUrl = await Linking.getInitialURL();\n    if (!initialUrl) {\n      return;\n    }\n    const { queryParams } = Linking.parse(initialUrl);\n    if (!queryParams || Object.keys(queryParams).length === 0) {\n      setScreenState(\"Home\");\n      return;\n    }\n\n    if (queryParams.request_uri) {\n      const requestResponse = await axios.get(\n        appendCorsAnywhere(Platform.OS, queryParams.request_uri)\n      );\n\n      const request = requestResponse.data;\n      const decodedRequest = jwt.decode(request);\n      await AsyncStorage.setItem(\"@request\", JSON.stringify(decodedRequest));\n      if (decodedRequest.prompt === \"create\") {\n        await AsyncStorage.setItem(\"@mode\", \"receive\");\n        const manifestUri =\n        decodedRequest.presentation_definition.input_descriptors[0].issuance[0]\n          .manifest;\n        const manifestResponse = await axios.get(\n          appendCorsAnywhere(Platform.OS, manifestUri)\n        );\n        const manifest = manifestResponse.data;\n        await AsyncStorage.setItem(\"@manifest\", JSON.stringify(manifest));\n      } else {\n        await AsyncStorage.setItem(\"@mode\", \"present\");\n      } \n    }\n    setScreenState(\"Response\");\n  };\n\n  React.useEffect(() => {\n    loadPrivateKeyAsync();\n    loadScreenAsync();\n  }, []);\n\n  return { isFontsLoaded, privateKeyState, screenState };\n};\n\nexport const initializeResponse = () => {\n  const [modeState, setModeState] = React.useState(\"\");\n  const [requestState, setRequestState] = React.useState<any>();\n  const [manifestState, setManifestState] = React.useState<any>();\n  const [\n    presentaionManifestState,\n    setPresentaionManifestState,\n  ] = React.useState<any>();\n  const [idTokenState, setIdTokenState] = React.useState(\"\");\n  const [vcState, setVcState] = React.useState<any>();\n\n  React.useEffect(() => {\n    (async () => {\n      const initialUrl = await Linking.getInitialURL();\n      if (!initialUrl) {\n        return;\n      }\n\n      const { queryParams } = Linking.parse(initialUrl);\n      if (!queryParams || Object.keys(queryParams).length === 0) {\n        return;\n      }\n\n      const manifestString = await AsyncStorage.getItem(\"@manifest\");\n      if (!manifestString) {\n        return;\n      }\n\n      const manifest = JSON.parse(manifestString);\n      setManifestState(manifest);\n\n      if (queryParams.code) {\n        const openIdConfigurationResponse = await axios.get(\n          manifest.input.attestations.idTokens[0].configuration\n        );\n        const openIdConfiguration = openIdConfigurationResponse.data;\n        const tokenResponse = await axios.get(\n          `${openIdConfiguration.token_endpoint}&grant_type=authorization_code&code=${queryParams.code}`\n        );\n        const idToken = tokenResponse.data.id_token;\n        setIdTokenState(idToken);\n      }\n\n      let presentationManifest;\n      if (manifest.input.attestations.presentations) {\n        const presentationManifestResponse = await axios.get(\n          manifest.input.attestations.presentations[0].contracts[0]\n        );\n        presentationManifest = presentationManifestResponse.data;\n        setPresentaionManifestState(presentationManifest);\n      }\n\n      const mode = await AsyncStorage.getItem(\"@mode\");\n      if (!mode) {\n        return;\n      }\n      setModeState(mode);\n\n      const requestString = await AsyncStorage.getItem(\"@request\");\n      if (!requestString) {\n        return;\n      }\n      const request = JSON.parse(requestString);\n      setRequestState(request);\n\n      const vcString = await AsyncStorage.getItem(\"@vc\");\n      if (vcString && (presentationManifest || mode===\"present\")) {\n        let key \n        if(mode===\"present\"){\n          key = request.presentation_definition.input_descriptors[0].schema.uri[0]\n        }\n        else if(mode===\"receive\"){\n          key = manifest.input.attestations.presentations[0].credentialType\n        }\n        const vc = JSON.parse(vcString);\n        setVcState(\n          vc[key]\n        );\n      }\n\n    })();\n  }, []);\n  return {\n    manifestState,\n    requestState,\n    modeState,\n    idTokenState,\n    vcState,\n    presentaionManifestState,\n  };\n};\n\nexport const initializeHome = () => {\n  const [vcState, setVcState] = React.useState<any>();\n\n  React.useEffect(() => {\n    (async () => {\n      const vcString = await AsyncStorage.getItem(\"@vc\");\n      if (!vcString) {\n        return;\n      }\n      const vc = JSON.parse(vcString);\n      setVcState(vc);\n    })();\n  }, []);\n  return { vcState };\n};\n"]},"metadata":{},"sourceType":"module"}