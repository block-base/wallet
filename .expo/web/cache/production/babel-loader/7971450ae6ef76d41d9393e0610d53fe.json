{"ast":null,"code":"var inherits=require('inherits');var Buffer=require('buffer').Buffer;var asn1=require(\"../../asn1\");var base=asn1.base;var der=asn1.constants.der;function DEREncoder(entity){this.enc='der';this.name=entity.name;this.entity=entity;this.tree=new DERNode();this.tree._init(entity.body);};module.exports=DEREncoder;DEREncoder.prototype.encode=function encode(data,reporter){return this.tree._encode(data,reporter).join();};function DERNode(parent){base.Node.call(this,'der',parent);}inherits(DERNode,base.Node);DERNode.prototype._encodeComposite=function encodeComposite(tag,primitive,cls,content){var encodedTag=encodeTag(tag,primitive,cls,this.reporter);if(content.length<0x80){var header=new Buffer(2);header[0]=encodedTag;header[1]=content.length;return this._createEncoderBuffer([header,content]);}var lenOctets=1;for(var i=content.length;i>=0x100;i>>=8){lenOctets++;}var header=new Buffer(1+1+lenOctets);header[0]=encodedTag;header[1]=0x80|lenOctets;for(var i=1+lenOctets,j=content.length;j>0;i--,j>>=8){header[i]=j&0xff;}return this._createEncoderBuffer([header,content]);};DERNode.prototype._encodeStr=function encodeStr(str,tag){if(tag==='bitstr'){return this._createEncoderBuffer([str.unused|0,str.data]);}else if(tag==='bmpstr'){var buf=new Buffer(str.length*2);for(var i=0;i<str.length;i++){buf.writeUInt16BE(str.charCodeAt(i),i*2);}return this._createEncoderBuffer(buf);}else if(tag==='numstr'){if(!this._isNumstr(str)){return this.reporter.error('Encoding of string type: numstr supports '+'only digits and space');}return this._createEncoderBuffer(str);}else if(tag==='printstr'){if(!this._isPrintstr(str)){return this.reporter.error('Encoding of string type: printstr supports '+'only latin upper and lower case letters, '+'digits, space, apostrophe, left and rigth '+'parenthesis, plus sign, comma, hyphen, '+'dot, slash, colon, equal sign, '+'question mark');}return this._createEncoderBuffer(str);}else if(/str$/.test(tag)){return this._createEncoderBuffer(str);}else if(tag==='objDesc'){return this._createEncoderBuffer(str);}else{return this.reporter.error('Encoding of string type: '+tag+' unsupported');}};DERNode.prototype._encodeObjid=function encodeObjid(id,values,relative){if(typeof id==='string'){if(!values)return this.reporter.error('string objid given, but no values map found');if(!values.hasOwnProperty(id))return this.reporter.error('objid not found in values map');id=values[id].split(/[\\s\\.]+/g);for(var i=0;i<id.length;i++){id[i]|=0;}}else if(Array.isArray(id)){id=id.slice();for(var i=0;i<id.length;i++){id[i]|=0;}}if(!Array.isArray(id)){return this.reporter.error('objid() should be either array or string, '+'got: '+JSON.stringify(id));}if(!relative){if(id[1]>=40)return this.reporter.error('Second objid identifier OOB');id.splice(0,2,id[0]*40+id[1]);}var size=0;for(var i=0;i<id.length;i++){var ident=id[i];for(size++;ident>=0x80;ident>>=7){size++;}}var objid=new Buffer(size);var offset=objid.length-1;for(var i=id.length-1;i>=0;i--){var ident=id[i];objid[offset--]=ident&0x7f;while((ident>>=7)>0){objid[offset--]=0x80|ident&0x7f;}}return this._createEncoderBuffer(objid);};function two(num){if(num<10)return'0'+num;else return num;}DERNode.prototype._encodeTime=function encodeTime(time,tag){var str;var date=new Date(time);if(tag==='gentime'){str=[two(date.getFullYear()),two(date.getUTCMonth()+1),two(date.getUTCDate()),two(date.getUTCHours()),two(date.getUTCMinutes()),two(date.getUTCSeconds()),'Z'].join('');}else if(tag==='utctime'){str=[two(date.getFullYear()%100),two(date.getUTCMonth()+1),two(date.getUTCDate()),two(date.getUTCHours()),two(date.getUTCMinutes()),two(date.getUTCSeconds()),'Z'].join('');}else{this.reporter.error('Encoding '+tag+' time is not supported yet');}return this._encodeStr(str,'octstr');};DERNode.prototype._encodeNull=function encodeNull(){return this._createEncoderBuffer('');};DERNode.prototype._encodeInt=function encodeInt(num,values){if(typeof num==='string'){if(!values)return this.reporter.error('String int or enum given, but no values map');if(!values.hasOwnProperty(num)){return this.reporter.error('Values map doesn\\'t contain: '+JSON.stringify(num));}num=values[num];}if(typeof num!=='number'&&!Buffer.isBuffer(num)){var numArray=num.toArray();if(!num.sign&&numArray[0]&0x80){numArray.unshift(0);}num=new Buffer(numArray);}if(Buffer.isBuffer(num)){var size=num.length;if(num.length===0)size++;var out=new Buffer(size);num.copy(out);if(num.length===0)out[0]=0;return this._createEncoderBuffer(out);}if(num<0x80)return this._createEncoderBuffer(num);if(num<0x100)return this._createEncoderBuffer([0,num]);var size=1;for(var i=num;i>=0x100;i>>=8){size++;}var out=new Array(size);for(var i=out.length-1;i>=0;i--){out[i]=num&0xff;num>>=8;}if(out[0]&0x80){out.unshift(0);}return this._createEncoderBuffer(new Buffer(out));};DERNode.prototype._encodeBool=function encodeBool(value){return this._createEncoderBuffer(value?0xff:0);};DERNode.prototype._use=function use(entity,obj){if(typeof entity==='function')entity=entity(obj);return entity._getEncoder('der').tree;};DERNode.prototype._skipDefault=function skipDefault(dataBuffer,reporter,parent){var state=this._baseState;var i;if(state['default']===null)return false;var data=dataBuffer.join();if(state.defaultBuffer===undefined)state.defaultBuffer=this._encodeValue(state['default'],reporter,parent).join();if(data.length!==state.defaultBuffer.length)return false;for(i=0;i<data.length;i++){if(data[i]!==state.defaultBuffer[i])return false;}return true;};function encodeTag(tag,primitive,cls,reporter){var res;if(tag==='seqof')tag='seq';else if(tag==='setof')tag='set';if(der.tagByName.hasOwnProperty(tag))res=der.tagByName[tag];else if(typeof tag==='number'&&(tag|0)===tag)res=tag;else return reporter.error('Unknown tag: '+tag);if(res>=0x1f)return reporter.error('Multi-octet tag encoding unsupported');if(!primitive)res|=0x20;res|=der.tagClassByName[cls||'universal']<<6;return res;}","map":{"version":3,"sources":["/Users/naohirofujie/.anyenv/envs/nodenv/versions/14.5.0/lib/node_modules/expo-cli/node_modules/asn1.js/lib/asn1/encoders/der.js"],"names":["inherits","require","Buffer","asn1","base","der","constants","DEREncoder","entity","enc","name","tree","DERNode","_init","body","module","exports","prototype","encode","data","reporter","_encode","join","parent","Node","call","_encodeComposite","encodeComposite","tag","primitive","cls","content","encodedTag","encodeTag","length","header","_createEncoderBuffer","lenOctets","i","j","_encodeStr","encodeStr","str","unused","buf","writeUInt16BE","charCodeAt","_isNumstr","error","_isPrintstr","test","_encodeObjid","encodeObjid","id","values","relative","hasOwnProperty","split","Array","isArray","slice","JSON","stringify","splice","size","ident","objid","offset","two","num","_encodeTime","encodeTime","time","date","Date","getFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","_encodeNull","encodeNull","_encodeInt","encodeInt","isBuffer","numArray","toArray","sign","unshift","out","copy","_encodeBool","encodeBool","value","_use","use","obj","_getEncoder","_skipDefault","skipDefault","dataBuffer","state","_baseState","defaultBuffer","undefined","_encodeValue","res","tagByName","tagClassByName"],"mappings":"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","sourcesContent":["var inherits = require('inherits');\nvar Buffer = require('buffer').Buffer;\n\nvar asn1 = require('../../asn1');\nvar base = asn1.base;\n\n// Import DER constants\nvar der = asn1.constants.der;\n\nfunction DEREncoder(entity) {\n  this.enc = 'der';\n  this.name = entity.name;\n  this.entity = entity;\n\n  // Construct base tree\n  this.tree = new DERNode();\n  this.tree._init(entity.body);\n};\nmodule.exports = DEREncoder;\n\nDEREncoder.prototype.encode = function encode(data, reporter) {\n  return this.tree._encode(data, reporter).join();\n};\n\n// Tree methods\n\nfunction DERNode(parent) {\n  base.Node.call(this, 'der', parent);\n}\ninherits(DERNode, base.Node);\n\nDERNode.prototype._encodeComposite = function encodeComposite(tag,\n                                                              primitive,\n                                                              cls,\n                                                              content) {\n  var encodedTag = encodeTag(tag, primitive, cls, this.reporter);\n\n  // Short form\n  if (content.length < 0x80) {\n    var header = new Buffer(2);\n    header[0] = encodedTag;\n    header[1] = content.length;\n    return this._createEncoderBuffer([ header, content ]);\n  }\n\n  // Long form\n  // Count octets required to store length\n  var lenOctets = 1;\n  for (var i = content.length; i >= 0x100; i >>= 8)\n    lenOctets++;\n\n  var header = new Buffer(1 + 1 + lenOctets);\n  header[0] = encodedTag;\n  header[1] = 0x80 | lenOctets;\n\n  for (var i = 1 + lenOctets, j = content.length; j > 0; i--, j >>= 8)\n    header[i] = j & 0xff;\n\n  return this._createEncoderBuffer([ header, content ]);\n};\n\nDERNode.prototype._encodeStr = function encodeStr(str, tag) {\n  if (tag === 'bitstr') {\n    return this._createEncoderBuffer([ str.unused | 0, str.data ]);\n  } else if (tag === 'bmpstr') {\n    var buf = new Buffer(str.length * 2);\n    for (var i = 0; i < str.length; i++) {\n      buf.writeUInt16BE(str.charCodeAt(i), i * 2);\n    }\n    return this._createEncoderBuffer(buf);\n  } else if (tag === 'numstr') {\n    if (!this._isNumstr(str)) {\n      return this.reporter.error('Encoding of string type: numstr supports ' +\n                                 'only digits and space');\n    }\n    return this._createEncoderBuffer(str);\n  } else if (tag === 'printstr') {\n    if (!this._isPrintstr(str)) {\n      return this.reporter.error('Encoding of string type: printstr supports ' +\n                                 'only latin upper and lower case letters, ' +\n                                 'digits, space, apostrophe, left and rigth ' +\n                                 'parenthesis, plus sign, comma, hyphen, ' +\n                                 'dot, slash, colon, equal sign, ' +\n                                 'question mark');\n    }\n    return this._createEncoderBuffer(str);\n  } else if (/str$/.test(tag)) {\n    return this._createEncoderBuffer(str);\n  } else if (tag === 'objDesc') {\n    return this._createEncoderBuffer(str);\n  } else {\n    return this.reporter.error('Encoding of string type: ' + tag +\n                               ' unsupported');\n  }\n};\n\nDERNode.prototype._encodeObjid = function encodeObjid(id, values, relative) {\n  if (typeof id === 'string') {\n    if (!values)\n      return this.reporter.error('string objid given, but no values map found');\n    if (!values.hasOwnProperty(id))\n      return this.reporter.error('objid not found in values map');\n    id = values[id].split(/[\\s\\.]+/g);\n    for (var i = 0; i < id.length; i++)\n      id[i] |= 0;\n  } else if (Array.isArray(id)) {\n    id = id.slice();\n    for (var i = 0; i < id.length; i++)\n      id[i] |= 0;\n  }\n\n  if (!Array.isArray(id)) {\n    return this.reporter.error('objid() should be either array or string, ' +\n                               'got: ' + JSON.stringify(id));\n  }\n\n  if (!relative) {\n    if (id[1] >= 40)\n      return this.reporter.error('Second objid identifier OOB');\n    id.splice(0, 2, id[0] * 40 + id[1]);\n  }\n\n  // Count number of octets\n  var size = 0;\n  for (var i = 0; i < id.length; i++) {\n    var ident = id[i];\n    for (size++; ident >= 0x80; ident >>= 7)\n      size++;\n  }\n\n  var objid = new Buffer(size);\n  var offset = objid.length - 1;\n  for (var i = id.length - 1; i >= 0; i--) {\n    var ident = id[i];\n    objid[offset--] = ident & 0x7f;\n    while ((ident >>= 7) > 0)\n      objid[offset--] = 0x80 | (ident & 0x7f);\n  }\n\n  return this._createEncoderBuffer(objid);\n};\n\nfunction two(num) {\n  if (num < 10)\n    return '0' + num;\n  else\n    return num;\n}\n\nDERNode.prototype._encodeTime = function encodeTime(time, tag) {\n  var str;\n  var date = new Date(time);\n\n  if (tag === 'gentime') {\n    str = [\n      two(date.getFullYear()),\n      two(date.getUTCMonth() + 1),\n      two(date.getUTCDate()),\n      two(date.getUTCHours()),\n      two(date.getUTCMinutes()),\n      two(date.getUTCSeconds()),\n      'Z'\n    ].join('');\n  } else if (tag === 'utctime') {\n    str = [\n      two(date.getFullYear() % 100),\n      two(date.getUTCMonth() + 1),\n      two(date.getUTCDate()),\n      two(date.getUTCHours()),\n      two(date.getUTCMinutes()),\n      two(date.getUTCSeconds()),\n      'Z'\n    ].join('');\n  } else {\n    this.reporter.error('Encoding ' + tag + ' time is not supported yet');\n  }\n\n  return this._encodeStr(str, 'octstr');\n};\n\nDERNode.prototype._encodeNull = function encodeNull() {\n  return this._createEncoderBuffer('');\n};\n\nDERNode.prototype._encodeInt = function encodeInt(num, values) {\n  if (typeof num === 'string') {\n    if (!values)\n      return this.reporter.error('String int or enum given, but no values map');\n    if (!values.hasOwnProperty(num)) {\n      return this.reporter.error('Values map doesn\\'t contain: ' +\n                                 JSON.stringify(num));\n    }\n    num = values[num];\n  }\n\n  // Bignum, assume big endian\n  if (typeof num !== 'number' && !Buffer.isBuffer(num)) {\n    var numArray = num.toArray();\n    if (!num.sign && numArray[0] & 0x80) {\n      numArray.unshift(0);\n    }\n    num = new Buffer(numArray);\n  }\n\n  if (Buffer.isBuffer(num)) {\n    var size = num.length;\n    if (num.length === 0)\n      size++;\n\n    var out = new Buffer(size);\n    num.copy(out);\n    if (num.length === 0)\n      out[0] = 0\n    return this._createEncoderBuffer(out);\n  }\n\n  if (num < 0x80)\n    return this._createEncoderBuffer(num);\n\n  if (num < 0x100)\n    return this._createEncoderBuffer([0, num]);\n\n  var size = 1;\n  for (var i = num; i >= 0x100; i >>= 8)\n    size++;\n\n  var out = new Array(size);\n  for (var i = out.length - 1; i >= 0; i--) {\n    out[i] = num & 0xff;\n    num >>= 8;\n  }\n  if(out[0] & 0x80) {\n    out.unshift(0);\n  }\n\n  return this._createEncoderBuffer(new Buffer(out));\n};\n\nDERNode.prototype._encodeBool = function encodeBool(value) {\n  return this._createEncoderBuffer(value ? 0xff : 0);\n};\n\nDERNode.prototype._use = function use(entity, obj) {\n  if (typeof entity === 'function')\n    entity = entity(obj);\n  return entity._getEncoder('der').tree;\n};\n\nDERNode.prototype._skipDefault = function skipDefault(dataBuffer, reporter, parent) {\n  var state = this._baseState;\n  var i;\n  if (state['default'] === null)\n    return false;\n\n  var data = dataBuffer.join();\n  if (state.defaultBuffer === undefined)\n    state.defaultBuffer = this._encodeValue(state['default'], reporter, parent).join();\n\n  if (data.length !== state.defaultBuffer.length)\n    return false;\n\n  for (i=0; i < data.length; i++)\n    if (data[i] !== state.defaultBuffer[i])\n      return false;\n\n  return true;\n};\n\n// Utility methods\n\nfunction encodeTag(tag, primitive, cls, reporter) {\n  var res;\n\n  if (tag === 'seqof')\n    tag = 'seq';\n  else if (tag === 'setof')\n    tag = 'set';\n\n  if (der.tagByName.hasOwnProperty(tag))\n    res = der.tagByName[tag];\n  else if (typeof tag === 'number' && (tag | 0) === tag)\n    res = tag;\n  else\n    return reporter.error('Unknown tag: ' + tag);\n\n  if (res >= 0x1f)\n    return reporter.error('Multi-octet tag encoding unsupported');\n\n  if (!primitive)\n    res |= 0x20;\n\n  res |= (der.tagClassByName[cls || 'universal'] << 6);\n\n  return res;\n}\n"]},"metadata":{},"sourceType":"script"}