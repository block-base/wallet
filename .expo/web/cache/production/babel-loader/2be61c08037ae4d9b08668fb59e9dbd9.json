{"ast":null,"code":"var Reporter=require(\"../base\").Reporter;var EncoderBuffer=require(\"../base\").EncoderBuffer;var DecoderBuffer=require(\"../base\").DecoderBuffer;var assert=require('minimalistic-assert');var tags=['seq','seqof','set','setof','objid','bool','gentime','utctime','null_','enum','int','objDesc','bitstr','bmpstr','charstr','genstr','graphstr','ia5str','iso646str','numstr','octstr','printstr','t61str','unistr','utf8str','videostr'];var methods=['key','obj','use','optional','explicit','implicit','def','choice','any','contains'].concat(tags);var overrided=['_peekTag','_decodeTag','_use','_decodeStr','_decodeObjid','_decodeTime','_decodeNull','_decodeInt','_decodeBool','_decodeList','_encodeComposite','_encodeStr','_encodeObjid','_encodeTime','_encodeNull','_encodeInt','_encodeBool'];function Node(enc,parent){var state={};this._baseState=state;state.enc=enc;state.parent=parent||null;state.children=null;state.tag=null;state.args=null;state.reverseArgs=null;state.choice=null;state.optional=false;state.any=false;state.obj=false;state.use=null;state.useDecoder=null;state.key=null;state['default']=null;state.explicit=null;state.implicit=null;state.contains=null;if(!state.parent){state.children=[];this._wrap();}}module.exports=Node;var stateProps=['enc','parent','children','tag','args','reverseArgs','choice','optional','any','obj','use','alteredUse','key','default','explicit','implicit','contains'];Node.prototype.clone=function clone(){var state=this._baseState;var cstate={};stateProps.forEach(function(prop){cstate[prop]=state[prop];});var res=new this.constructor(cstate.parent);res._baseState=cstate;return res;};Node.prototype._wrap=function wrap(){var state=this._baseState;methods.forEach(function(method){this[method]=function _wrappedMethod(){var clone=new this.constructor(this);state.children.push(clone);return clone[method].apply(clone,arguments);};},this);};Node.prototype._init=function init(body){var state=this._baseState;assert(state.parent===null);body.call(this);state.children=state.children.filter(function(child){return child._baseState.parent===this;},this);assert.equal(state.children.length,1,'Root node can have only one child');};Node.prototype._useArgs=function useArgs(args){var state=this._baseState;var children=args.filter(function(arg){return arg instanceof this.constructor;},this);args=args.filter(function(arg){return!(arg instanceof this.constructor);},this);if(children.length!==0){assert(state.children===null);state.children=children;children.forEach(function(child){child._baseState.parent=this;},this);}if(args.length!==0){assert(state.args===null);state.args=args;state.reverseArgs=args.map(function(arg){if(typeof arg!=='object'||arg.constructor!==Object)return arg;var res={};Object.keys(arg).forEach(function(key){if(key==(key|0))key|=0;var value=arg[key];res[value]=key;});return res;});}};overrided.forEach(function(method){Node.prototype[method]=function _overrided(){var state=this._baseState;throw new Error(method+' not implemented for encoding: '+state.enc);};});tags.forEach(function(tag){Node.prototype[tag]=function _tagMethod(){var state=this._baseState;var args=Array.prototype.slice.call(arguments);assert(state.tag===null);state.tag=tag;this._useArgs(args);return this;};});Node.prototype.use=function use(item){assert(item);var state=this._baseState;assert(state.use===null);state.use=item;return this;};Node.prototype.optional=function optional(){var state=this._baseState;state.optional=true;return this;};Node.prototype.def=function def(val){var state=this._baseState;assert(state['default']===null);state['default']=val;state.optional=true;return this;};Node.prototype.explicit=function explicit(num){var state=this._baseState;assert(state.explicit===null&&state.implicit===null);state.explicit=num;return this;};Node.prototype.implicit=function implicit(num){var state=this._baseState;assert(state.explicit===null&&state.implicit===null);state.implicit=num;return this;};Node.prototype.obj=function obj(){var state=this._baseState;var args=Array.prototype.slice.call(arguments);state.obj=true;if(args.length!==0)this._useArgs(args);return this;};Node.prototype.key=function key(newKey){var state=this._baseState;assert(state.key===null);state.key=newKey;return this;};Node.prototype.any=function any(){var state=this._baseState;state.any=true;return this;};Node.prototype.choice=function choice(obj){var state=this._baseState;assert(state.choice===null);state.choice=obj;this._useArgs(Object.keys(obj).map(function(key){return obj[key];}));return this;};Node.prototype.contains=function contains(item){var state=this._baseState;assert(state.use===null);state.contains=item;return this;};Node.prototype._decode=function decode(input,options){var state=this._baseState;if(state.parent===null)return input.wrapResult(state.children[0]._decode(input,options));var result=state['default'];var present=true;var prevKey=null;if(state.key!==null)prevKey=input.enterKey(state.key);if(state.optional){var tag=null;if(state.explicit!==null)tag=state.explicit;else if(state.implicit!==null)tag=state.implicit;else if(state.tag!==null)tag=state.tag;if(tag===null&&!state.any){var save=input.save();try{if(state.choice===null)this._decodeGeneric(state.tag,input,options);else this._decodeChoice(input,options);present=true;}catch(e){present=false;}input.restore(save);}else{present=this._peekTag(input,tag,state.any);if(input.isError(present))return present;}}var prevObj;if(state.obj&&present)prevObj=input.enterObject();if(present){if(state.explicit!==null){var explicit=this._decodeTag(input,state.explicit);if(input.isError(explicit))return explicit;input=explicit;}var start=input.offset;if(state.use===null&&state.choice===null){if(state.any)var save=input.save();var body=this._decodeTag(input,state.implicit!==null?state.implicit:state.tag,state.any);if(input.isError(body))return body;if(state.any)result=input.raw(save);else input=body;}if(options&&options.track&&state.tag!==null)options.track(input.path(),start,input.length,'tagged');if(options&&options.track&&state.tag!==null)options.track(input.path(),input.offset,input.length,'content');if(state.any)result=result;else if(state.choice===null)result=this._decodeGeneric(state.tag,input,options);else result=this._decodeChoice(input,options);if(input.isError(result))return result;if(!state.any&&state.choice===null&&state.children!==null){state.children.forEach(function decodeChildren(child){child._decode(input,options);});}if(state.contains&&(state.tag==='octstr'||state.tag==='bitstr')){var data=new DecoderBuffer(result);result=this._getUse(state.contains,input._reporterState.obj)._decode(data,options);}}if(state.obj&&present)result=input.leaveObject(prevObj);if(state.key!==null&&(result!==null||present===true))input.leaveKey(prevKey,state.key,result);else if(prevKey!==null)input.exitKey(prevKey);return result;};Node.prototype._decodeGeneric=function decodeGeneric(tag,input,options){var state=this._baseState;if(tag==='seq'||tag==='set')return null;if(tag==='seqof'||tag==='setof')return this._decodeList(input,tag,state.args[0],options);else if(/str$/.test(tag))return this._decodeStr(input,tag,options);else if(tag==='objid'&&state.args)return this._decodeObjid(input,state.args[0],state.args[1],options);else if(tag==='objid')return this._decodeObjid(input,null,null,options);else if(tag==='gentime'||tag==='utctime')return this._decodeTime(input,tag,options);else if(tag==='null_')return this._decodeNull(input,options);else if(tag==='bool')return this._decodeBool(input,options);else if(tag==='objDesc')return this._decodeStr(input,tag,options);else if(tag==='int'||tag==='enum')return this._decodeInt(input,state.args&&state.args[0],options);if(state.use!==null){return this._getUse(state.use,input._reporterState.obj)._decode(input,options);}else{return input.error('unknown tag: '+tag);}};Node.prototype._getUse=function _getUse(entity,obj){var state=this._baseState;state.useDecoder=this._use(entity,obj);assert(state.useDecoder._baseState.parent===null);state.useDecoder=state.useDecoder._baseState.children[0];if(state.implicit!==state.useDecoder._baseState.implicit){state.useDecoder=state.useDecoder.clone();state.useDecoder._baseState.implicit=state.implicit;}return state.useDecoder;};Node.prototype._decodeChoice=function decodeChoice(input,options){var state=this._baseState;var result=null;var match=false;Object.keys(state.choice).some(function(key){var save=input.save();var node=state.choice[key];try{var value=node._decode(input,options);if(input.isError(value))return false;result={type:key,value:value};match=true;}catch(e){input.restore(save);return false;}return true;},this);if(!match)return input.error('Choice not matched');return result;};Node.prototype._createEncoderBuffer=function createEncoderBuffer(data){return new EncoderBuffer(data,this.reporter);};Node.prototype._encode=function encode(data,reporter,parent){var state=this._baseState;if(state['default']!==null&&state['default']===data)return;var result=this._encodeValue(data,reporter,parent);if(result===undefined)return;if(this._skipDefault(result,reporter,parent))return;return result;};Node.prototype._encodeValue=function encode(data,reporter,parent){var state=this._baseState;if(state.parent===null)return state.children[0]._encode(data,reporter||new Reporter());var result=null;this.reporter=reporter;if(state.optional&&data===undefined){if(state['default']!==null)data=state['default'];else return;}var content=null;var primitive=false;if(state.any){result=this._createEncoderBuffer(data);}else if(state.choice){result=this._encodeChoice(data,reporter);}else if(state.contains){content=this._getUse(state.contains,parent)._encode(data,reporter);primitive=true;}else if(state.children){content=state.children.map(function(child){if(child._baseState.tag==='null_')return child._encode(null,reporter,data);if(child._baseState.key===null)return reporter.error('Child should have a key');var prevKey=reporter.enterKey(child._baseState.key);if(typeof data!=='object')return reporter.error('Child expected, but input is not object');var res=child._encode(data[child._baseState.key],reporter,data);reporter.leaveKey(prevKey);return res;},this).filter(function(child){return child;});content=this._createEncoderBuffer(content);}else{if(state.tag==='seqof'||state.tag==='setof'){if(!(state.args&&state.args.length===1))return reporter.error('Too many args for : '+state.tag);if(!Array.isArray(data))return reporter.error('seqof/setof, but data is not Array');var child=this.clone();child._baseState.implicit=null;content=this._createEncoderBuffer(data.map(function(item){var state=this._baseState;return this._getUse(state.args[0],data)._encode(item,reporter);},child));}else if(state.use!==null){result=this._getUse(state.use,parent)._encode(data,reporter);}else{content=this._encodePrimitive(state.tag,data);primitive=true;}}var result;if(!state.any&&state.choice===null){var tag=state.implicit!==null?state.implicit:state.tag;var cls=state.implicit===null?'universal':'context';if(tag===null){if(state.use===null)reporter.error('Tag could be omitted only for .use()');}else{if(state.use===null)result=this._encodeComposite(tag,primitive,cls,content);}}if(state.explicit!==null)result=this._encodeComposite(state.explicit,false,'context',result);return result;};Node.prototype._encodeChoice=function encodeChoice(data,reporter){var state=this._baseState;var node=state.choice[data.type];if(!node){assert(false,data.type+' not found in '+JSON.stringify(Object.keys(state.choice)));}return node._encode(data.value,reporter);};Node.prototype._encodePrimitive=function encodePrimitive(tag,data){var state=this._baseState;if(/str$/.test(tag))return this._encodeStr(data,tag);else if(tag==='objid'&&state.args)return this._encodeObjid(data,state.reverseArgs[0],state.args[1]);else if(tag==='objid')return this._encodeObjid(data,null,null);else if(tag==='gentime'||tag==='utctime')return this._encodeTime(data,tag);else if(tag==='null_')return this._encodeNull();else if(tag==='int'||tag==='enum')return this._encodeInt(data,state.args&&state.reverseArgs[0]);else if(tag==='bool')return this._encodeBool(data);else if(tag==='objDesc')return this._encodeStr(data,tag);else throw new Error('Unsupported tag: '+tag);};Node.prototype._isNumstr=function isNumstr(str){return /^[0-9 ]*$/.test(str);};Node.prototype._isPrintstr=function isPrintstr(str){return /^[A-Za-z0-9 '\\(\\)\\+,\\-\\.\\/:=\\?]*$/.test(str);};","map":{"version":3,"sources":["/Users/naohirofujie/.anyenv/envs/nodenv/versions/14.5.0/lib/node_modules/expo-cli/node_modules/asn1.js/lib/asn1/base/node.js"],"names":["Reporter","require","EncoderBuffer","DecoderBuffer","assert","tags","methods","concat","overrided","Node","enc","parent","state","_baseState","children","tag","args","reverseArgs","choice","optional","any","obj","use","useDecoder","key","explicit","implicit","contains","_wrap","module","exports","stateProps","prototype","clone","cstate","forEach","prop","res","constructor","wrap","method","_wrappedMethod","push","apply","arguments","_init","init","body","call","filter","child","equal","length","_useArgs","useArgs","arg","map","Object","keys","value","_overrided","Error","_tagMethod","Array","slice","item","def","val","num","newKey","_decode","decode","input","options","wrapResult","result","present","prevKey","enterKey","save","_decodeGeneric","_decodeChoice","e","restore","_peekTag","isError","prevObj","enterObject","_decodeTag","start","offset","raw","track","path","decodeChildren","data","_getUse","_reporterState","leaveObject","leaveKey","exitKey","decodeGeneric","_decodeList","test","_decodeStr","_decodeObjid","_decodeTime","_decodeNull","_decodeBool","_decodeInt","error","entity","_use","decodeChoice","match","some","node","type","_createEncoderBuffer","createEncoderBuffer","reporter","_encode","encode","_encodeValue","undefined","_skipDefault","content","primitive","_encodeChoice","isArray","_encodePrimitive","cls","_encodeComposite","encodeChoice","JSON","stringify","encodePrimitive","_encodeStr","_encodeObjid","_encodeTime","_encodeNull","_encodeInt","_encodeBool","_isNumstr","isNumstr","str","_isPrintstr","isPrintstr"],"mappings":"AAAA,GAAIA,CAAAA,QAAQ,CAAGC,OAAO,WAAP,CAAmBD,QAAlC,CACA,GAAIE,CAAAA,aAAa,CAAGD,OAAO,WAAP,CAAmBC,aAAvC,CACA,GAAIC,CAAAA,aAAa,CAAGF,OAAO,WAAP,CAAmBE,aAAvC,CACA,GAAIC,CAAAA,MAAM,CAAGH,OAAO,CAAC,qBAAD,CAApB,CAGA,GAAII,CAAAA,IAAI,CAAG,CACT,KADS,CACF,OADE,CACO,KADP,CACc,OADd,CACuB,OADvB,CACgC,MADhC,CAET,SAFS,CAEE,SAFF,CAEa,OAFb,CAEsB,MAFtB,CAE8B,KAF9B,CAEqC,SAFrC,CAGT,QAHS,CAGC,QAHD,CAGW,SAHX,CAGsB,QAHtB,CAGgC,UAHhC,CAG4C,QAH5C,CAGsD,WAHtD,CAIT,QAJS,CAIC,QAJD,CAIW,UAJX,CAIuB,QAJvB,CAIiC,QAJjC,CAI2C,SAJ3C,CAIsD,UAJtD,CAAX,CAQA,GAAIC,CAAAA,OAAO,CAAG,CACZ,KADY,CACL,KADK,CACE,KADF,CACS,UADT,CACqB,UADrB,CACiC,UADjC,CAC6C,KAD7C,CACoD,QADpD,CAEZ,KAFY,CAEL,UAFK,EAGZC,MAHY,CAGLF,IAHK,CAAd,CAMA,GAAIG,CAAAA,SAAS,CAAG,CACd,UADc,CACF,YADE,CACY,MADZ,CAEd,YAFc,CAEA,cAFA,CAEgB,aAFhB,CAGd,aAHc,CAGC,YAHD,CAGe,aAHf,CAG8B,aAH9B,CAKd,kBALc,CAKM,YALN,CAKoB,cALpB,CAKoC,aALpC,CAMd,aANc,CAMC,YAND,CAMe,aANf,CAAhB,CASA,QAASC,CAAAA,IAAT,CAAcC,GAAd,CAAmBC,MAAnB,CAA2B,CACzB,GAAIC,CAAAA,KAAK,CAAG,EAAZ,CACA,KAAKC,UAAL,CAAkBD,KAAlB,CAEAA,KAAK,CAACF,GAAN,CAAYA,GAAZ,CAEAE,KAAK,CAACD,MAAN,CAAeA,MAAM,EAAI,IAAzB,CACAC,KAAK,CAACE,QAAN,CAAiB,IAAjB,CAGAF,KAAK,CAACG,GAAN,CAAY,IAAZ,CACAH,KAAK,CAACI,IAAN,CAAa,IAAb,CACAJ,KAAK,CAACK,WAAN,CAAoB,IAApB,CACAL,KAAK,CAACM,MAAN,CAAe,IAAf,CACAN,KAAK,CAACO,QAAN,CAAiB,KAAjB,CACAP,KAAK,CAACQ,GAAN,CAAY,KAAZ,CACAR,KAAK,CAACS,GAAN,CAAY,KAAZ,CACAT,KAAK,CAACU,GAAN,CAAY,IAAZ,CACAV,KAAK,CAACW,UAAN,CAAmB,IAAnB,CACAX,KAAK,CAACY,GAAN,CAAY,IAAZ,CACAZ,KAAK,CAAC,SAAD,CAAL,CAAmB,IAAnB,CACAA,KAAK,CAACa,QAAN,CAAiB,IAAjB,CACAb,KAAK,CAACc,QAAN,CAAiB,IAAjB,CACAd,KAAK,CAACe,QAAN,CAAiB,IAAjB,CAGA,GAAI,CAACf,KAAK,CAACD,MAAX,CAAmB,CACjBC,KAAK,CAACE,QAAN,CAAiB,EAAjB,CACA,KAAKc,KAAL,GACD,CACF,CACDC,MAAM,CAACC,OAAP,CAAiBrB,IAAjB,CAEA,GAAIsB,CAAAA,UAAU,CAAG,CACf,KADe,CACR,QADQ,CACE,UADF,CACc,KADd,CACqB,MADrB,CAC6B,aAD7B,CAC4C,QAD5C,CAEf,UAFe,CAEH,KAFG,CAEI,KAFJ,CAEW,KAFX,CAEkB,YAFlB,CAEgC,KAFhC,CAEuC,SAFvC,CAEkD,UAFlD,CAGf,UAHe,CAGH,UAHG,CAAjB,CAMAtB,IAAI,CAACuB,SAAL,CAAeC,KAAf,CAAuB,QAASA,CAAAA,KAAT,EAAiB,CACtC,GAAIrB,CAAAA,KAAK,CAAG,KAAKC,UAAjB,CACA,GAAIqB,CAAAA,MAAM,CAAG,EAAb,CACAH,UAAU,CAACI,OAAX,CAAmB,SAASC,IAAT,CAAe,CAChCF,MAAM,CAACE,IAAD,CAAN,CAAexB,KAAK,CAACwB,IAAD,CAApB,CACD,CAFD,EAGA,GAAIC,CAAAA,GAAG,CAAG,GAAI,MAAKC,WAAT,CAAqBJ,MAAM,CAACvB,MAA5B,CAAV,CACA0B,GAAG,CAACxB,UAAJ,CAAiBqB,MAAjB,CACA,MAAOG,CAAAA,GAAP,CACD,CATD,CAWA5B,IAAI,CAACuB,SAAL,CAAeJ,KAAf,CAAuB,QAASW,CAAAA,IAAT,EAAgB,CACrC,GAAI3B,CAAAA,KAAK,CAAG,KAAKC,UAAjB,CACAP,OAAO,CAAC6B,OAAR,CAAgB,SAASK,MAAT,CAAiB,CAC/B,KAAKA,MAAL,EAAe,QAASC,CAAAA,cAAT,EAA0B,CACvC,GAAIR,CAAAA,KAAK,CAAG,GAAI,MAAKK,WAAT,CAAqB,IAArB,CAAZ,CACA1B,KAAK,CAACE,QAAN,CAAe4B,IAAf,CAAoBT,KAApB,EACA,MAAOA,CAAAA,KAAK,CAACO,MAAD,CAAL,CAAcG,KAAd,CAAoBV,KAApB,CAA2BW,SAA3B,CAAP,CACD,CAJD,CAKD,CAND,CAMG,IANH,EAOD,CATD,CAWAnC,IAAI,CAACuB,SAAL,CAAea,KAAf,CAAuB,QAASC,CAAAA,IAAT,CAAcC,IAAd,CAAoB,CACzC,GAAInC,CAAAA,KAAK,CAAG,KAAKC,UAAjB,CAEAT,MAAM,CAACQ,KAAK,CAACD,MAAN,GAAiB,IAAlB,CAAN,CACAoC,IAAI,CAACC,IAAL,CAAU,IAAV,EAGApC,KAAK,CAACE,QAAN,CAAiBF,KAAK,CAACE,QAAN,CAAemC,MAAf,CAAsB,SAASC,KAAT,CAAgB,CACrD,MAAOA,CAAAA,KAAK,CAACrC,UAAN,CAAiBF,MAAjB,GAA4B,IAAnC,CACD,CAFgB,CAEd,IAFc,CAAjB,CAGAP,MAAM,CAAC+C,KAAP,CAAavC,KAAK,CAACE,QAAN,CAAesC,MAA5B,CAAoC,CAApC,CAAuC,mCAAvC,EACD,CAXD,CAaA3C,IAAI,CAACuB,SAAL,CAAeqB,QAAf,CAA0B,QAASC,CAAAA,OAAT,CAAiBtC,IAAjB,CAAuB,CAC/C,GAAIJ,CAAAA,KAAK,CAAG,KAAKC,UAAjB,CAGA,GAAIC,CAAAA,QAAQ,CAAGE,IAAI,CAACiC,MAAL,CAAY,SAASM,GAAT,CAAc,CACvC,MAAOA,CAAAA,GAAG,WAAY,MAAKjB,WAA3B,CACD,CAFc,CAEZ,IAFY,CAAf,CAGAtB,IAAI,CAAGA,IAAI,CAACiC,MAAL,CAAY,SAASM,GAAT,CAAc,CAC/B,MAAO,EAAEA,GAAG,WAAY,MAAKjB,WAAtB,CAAP,CACD,CAFM,CAEJ,IAFI,CAAP,CAIA,GAAIxB,QAAQ,CAACsC,MAAT,GAAoB,CAAxB,CAA2B,CACzBhD,MAAM,CAACQ,KAAK,CAACE,QAAN,GAAmB,IAApB,CAAN,CACAF,KAAK,CAACE,QAAN,CAAiBA,QAAjB,CAGAA,QAAQ,CAACqB,OAAT,CAAiB,SAASe,KAAT,CAAgB,CAC/BA,KAAK,CAACrC,UAAN,CAAiBF,MAAjB,CAA0B,IAA1B,CACD,CAFD,CAEG,IAFH,EAGD,CACD,GAAIK,IAAI,CAACoC,MAAL,GAAgB,CAApB,CAAuB,CACrBhD,MAAM,CAACQ,KAAK,CAACI,IAAN,GAAe,IAAhB,CAAN,CACAJ,KAAK,CAACI,IAAN,CAAaA,IAAb,CACAJ,KAAK,CAACK,WAAN,CAAoBD,IAAI,CAACwC,GAAL,CAAS,SAASD,GAAT,CAAc,CACzC,GAAI,MAAOA,CAAAA,GAAP,GAAe,QAAf,EAA2BA,GAAG,CAACjB,WAAJ,GAAoBmB,MAAnD,CACE,MAAOF,CAAAA,GAAP,CAEF,GAAIlB,CAAAA,GAAG,CAAG,EAAV,CACAoB,MAAM,CAACC,IAAP,CAAYH,GAAZ,EAAiBpB,OAAjB,CAAyB,SAASX,GAAT,CAAc,CACrC,GAAIA,GAAG,GAAKA,GAAG,CAAG,CAAX,CAAP,CACEA,GAAG,EAAI,CAAP,CACF,GAAImC,CAAAA,KAAK,CAAGJ,GAAG,CAAC/B,GAAD,CAAf,CACAa,GAAG,CAACsB,KAAD,CAAH,CAAanC,GAAb,CACD,CALD,EAMA,MAAOa,CAAAA,GAAP,CACD,CAZmB,CAApB,CAaD,CACF,CArCD,CA2CA7B,SAAS,CAAC2B,OAAV,CAAkB,SAASK,MAAT,CAAiB,CACjC/B,IAAI,CAACuB,SAAL,CAAeQ,MAAf,EAAyB,QAASoB,CAAAA,UAAT,EAAsB,CAC7C,GAAIhD,CAAAA,KAAK,CAAG,KAAKC,UAAjB,CACA,KAAM,IAAIgD,CAAAA,KAAJ,CAAUrB,MAAM,CAAG,iCAAT,CAA6C5B,KAAK,CAACF,GAA7D,CAAN,CACD,CAHD,CAID,CALD,EAWAL,IAAI,CAAC8B,OAAL,CAAa,SAASpB,GAAT,CAAc,CACzBN,IAAI,CAACuB,SAAL,CAAejB,GAAf,EAAsB,QAAS+C,CAAAA,UAAT,EAAsB,CAC1C,GAAIlD,CAAAA,KAAK,CAAG,KAAKC,UAAjB,CACA,GAAIG,CAAAA,IAAI,CAAG+C,KAAK,CAAC/B,SAAN,CAAgBgC,KAAhB,CAAsBhB,IAAtB,CAA2BJ,SAA3B,CAAX,CAEAxC,MAAM,CAACQ,KAAK,CAACG,GAAN,GAAc,IAAf,CAAN,CACAH,KAAK,CAACG,GAAN,CAAYA,GAAZ,CAEA,KAAKsC,QAAL,CAAcrC,IAAd,EAEA,MAAO,KAAP,CACD,CAVD,CAWD,CAZD,EAcAP,IAAI,CAACuB,SAAL,CAAeV,GAAf,CAAqB,QAASA,CAAAA,GAAT,CAAa2C,IAAb,CAAmB,CACtC7D,MAAM,CAAC6D,IAAD,CAAN,CACA,GAAIrD,CAAAA,KAAK,CAAG,KAAKC,UAAjB,CAEAT,MAAM,CAACQ,KAAK,CAACU,GAAN,GAAc,IAAf,CAAN,CACAV,KAAK,CAACU,GAAN,CAAY2C,IAAZ,CAEA,MAAO,KAAP,CACD,CARD,CAUAxD,IAAI,CAACuB,SAAL,CAAeb,QAAf,CAA0B,QAASA,CAAAA,QAAT,EAAoB,CAC5C,GAAIP,CAAAA,KAAK,CAAG,KAAKC,UAAjB,CAEAD,KAAK,CAACO,QAAN,CAAiB,IAAjB,CAEA,MAAO,KAAP,CACD,CAND,CAQAV,IAAI,CAACuB,SAAL,CAAekC,GAAf,CAAqB,QAASA,CAAAA,GAAT,CAAaC,GAAb,CAAkB,CACrC,GAAIvD,CAAAA,KAAK,CAAG,KAAKC,UAAjB,CAEAT,MAAM,CAACQ,KAAK,CAAC,SAAD,CAAL,GAAqB,IAAtB,CAAN,CACAA,KAAK,CAAC,SAAD,CAAL,CAAmBuD,GAAnB,CACAvD,KAAK,CAACO,QAAN,CAAiB,IAAjB,CAEA,MAAO,KAAP,CACD,CARD,CAUAV,IAAI,CAACuB,SAAL,CAAeP,QAAf,CAA0B,QAASA,CAAAA,QAAT,CAAkB2C,GAAlB,CAAuB,CAC/C,GAAIxD,CAAAA,KAAK,CAAG,KAAKC,UAAjB,CAEAT,MAAM,CAACQ,KAAK,CAACa,QAAN,GAAmB,IAAnB,EAA2Bb,KAAK,CAACc,QAAN,GAAmB,IAA/C,CAAN,CACAd,KAAK,CAACa,QAAN,CAAiB2C,GAAjB,CAEA,MAAO,KAAP,CACD,CAPD,CASA3D,IAAI,CAACuB,SAAL,CAAeN,QAAf,CAA0B,QAASA,CAAAA,QAAT,CAAkB0C,GAAlB,CAAuB,CAC/C,GAAIxD,CAAAA,KAAK,CAAG,KAAKC,UAAjB,CAEAT,MAAM,CAACQ,KAAK,CAACa,QAAN,GAAmB,IAAnB,EAA2Bb,KAAK,CAACc,QAAN,GAAmB,IAA/C,CAAN,CACAd,KAAK,CAACc,QAAN,CAAiB0C,GAAjB,CAEA,MAAO,KAAP,CACD,CAPD,CASA3D,IAAI,CAACuB,SAAL,CAAeX,GAAf,CAAqB,QAASA,CAAAA,GAAT,EAAe,CAClC,GAAIT,CAAAA,KAAK,CAAG,KAAKC,UAAjB,CACA,GAAIG,CAAAA,IAAI,CAAG+C,KAAK,CAAC/B,SAAN,CAAgBgC,KAAhB,CAAsBhB,IAAtB,CAA2BJ,SAA3B,CAAX,CAEAhC,KAAK,CAACS,GAAN,CAAY,IAAZ,CAEA,GAAIL,IAAI,CAACoC,MAAL,GAAgB,CAApB,CACE,KAAKC,QAAL,CAAcrC,IAAd,EAEF,MAAO,KAAP,CACD,CAVD,CAYAP,IAAI,CAACuB,SAAL,CAAeR,GAAf,CAAqB,QAASA,CAAAA,GAAT,CAAa6C,MAAb,CAAqB,CACxC,GAAIzD,CAAAA,KAAK,CAAG,KAAKC,UAAjB,CAEAT,MAAM,CAACQ,KAAK,CAACY,GAAN,GAAc,IAAf,CAAN,CACAZ,KAAK,CAACY,GAAN,CAAY6C,MAAZ,CAEA,MAAO,KAAP,CACD,CAPD,CASA5D,IAAI,CAACuB,SAAL,CAAeZ,GAAf,CAAqB,QAASA,CAAAA,GAAT,EAAe,CAClC,GAAIR,CAAAA,KAAK,CAAG,KAAKC,UAAjB,CAEAD,KAAK,CAACQ,GAAN,CAAY,IAAZ,CAEA,MAAO,KAAP,CACD,CAND,CAQAX,IAAI,CAACuB,SAAL,CAAed,MAAf,CAAwB,QAASA,CAAAA,MAAT,CAAgBG,GAAhB,CAAqB,CAC3C,GAAIT,CAAAA,KAAK,CAAG,KAAKC,UAAjB,CAEAT,MAAM,CAACQ,KAAK,CAACM,MAAN,GAAiB,IAAlB,CAAN,CACAN,KAAK,CAACM,MAAN,CAAeG,GAAf,CACA,KAAKgC,QAAL,CAAcI,MAAM,CAACC,IAAP,CAAYrC,GAAZ,EAAiBmC,GAAjB,CAAqB,SAAShC,GAAT,CAAc,CAC/C,MAAOH,CAAAA,GAAG,CAACG,GAAD,CAAV,CACD,CAFa,CAAd,EAIA,MAAO,KAAP,CACD,CAVD,CAYAf,IAAI,CAACuB,SAAL,CAAeL,QAAf,CAA0B,QAASA,CAAAA,QAAT,CAAkBsC,IAAlB,CAAwB,CAChD,GAAIrD,CAAAA,KAAK,CAAG,KAAKC,UAAjB,CAEAT,MAAM,CAACQ,KAAK,CAACU,GAAN,GAAc,IAAf,CAAN,CACAV,KAAK,CAACe,QAAN,CAAiBsC,IAAjB,CAEA,MAAO,KAAP,CACD,CAPD,CAaAxD,IAAI,CAACuB,SAAL,CAAesC,OAAf,CAAyB,QAASC,CAAAA,MAAT,CAAgBC,KAAhB,CAAuBC,OAAvB,CAAgC,CACvD,GAAI7D,CAAAA,KAAK,CAAG,KAAKC,UAAjB,CAGA,GAAID,KAAK,CAACD,MAAN,GAAiB,IAArB,CACE,MAAO6D,CAAAA,KAAK,CAACE,UAAN,CAAiB9D,KAAK,CAACE,QAAN,CAAe,CAAf,EAAkBwD,OAAlB,CAA0BE,KAA1B,CAAiCC,OAAjC,CAAjB,CAAP,CAEF,GAAIE,CAAAA,MAAM,CAAG/D,KAAK,CAAC,SAAD,CAAlB,CACA,GAAIgE,CAAAA,OAAO,CAAG,IAAd,CAEA,GAAIC,CAAAA,OAAO,CAAG,IAAd,CACA,GAAIjE,KAAK,CAACY,GAAN,GAAc,IAAlB,CACEqD,OAAO,CAAGL,KAAK,CAACM,QAAN,CAAelE,KAAK,CAACY,GAArB,CAAV,CAGF,GAAIZ,KAAK,CAACO,QAAV,CAAoB,CAClB,GAAIJ,CAAAA,GAAG,CAAG,IAAV,CACA,GAAIH,KAAK,CAACa,QAAN,GAAmB,IAAvB,CACEV,GAAG,CAAGH,KAAK,CAACa,QAAZ,CADF,IAEK,IAAIb,KAAK,CAACc,QAAN,GAAmB,IAAvB,CACHX,GAAG,CAAGH,KAAK,CAACc,QAAZ,CADG,IAEA,IAAId,KAAK,CAACG,GAAN,GAAc,IAAlB,CACHA,GAAG,CAAGH,KAAK,CAACG,GAAZ,CAEF,GAAIA,GAAG,GAAK,IAAR,EAAgB,CAACH,KAAK,CAACQ,GAA3B,CAAgC,CAE9B,GAAI2D,CAAAA,IAAI,CAAGP,KAAK,CAACO,IAAN,EAAX,CACA,GAAI,CACF,GAAInE,KAAK,CAACM,MAAN,GAAiB,IAArB,CACE,KAAK8D,cAAL,CAAoBpE,KAAK,CAACG,GAA1B,CAA+ByD,KAA/B,CAAsCC,OAAtC,EADF,IAGE,MAAKQ,aAAL,CAAmBT,KAAnB,CAA0BC,OAA1B,EACFG,OAAO,CAAG,IAAV,CACD,CAAC,MAAOM,CAAP,CAAU,CACVN,OAAO,CAAG,KAAV,CACD,CACDJ,KAAK,CAACW,OAAN,CAAcJ,IAAd,EACD,CAbD,IAaO,CACLH,OAAO,CAAG,KAAKQ,QAAL,CAAcZ,KAAd,CAAqBzD,GAArB,CAA0BH,KAAK,CAACQ,GAAhC,CAAV,CAEA,GAAIoD,KAAK,CAACa,OAAN,CAAcT,OAAd,CAAJ,CACE,MAAOA,CAAAA,OAAP,CACH,CACF,CAGD,GAAIU,CAAAA,OAAJ,CACA,GAAI1E,KAAK,CAACS,GAAN,EAAauD,OAAjB,CACEU,OAAO,CAAGd,KAAK,CAACe,WAAN,EAAV,CAEF,GAAIX,OAAJ,CAAa,CAEX,GAAIhE,KAAK,CAACa,QAAN,GAAmB,IAAvB,CAA6B,CAC3B,GAAIA,CAAAA,QAAQ,CAAG,KAAK+D,UAAL,CAAgBhB,KAAhB,CAAuB5D,KAAK,CAACa,QAA7B,CAAf,CACA,GAAI+C,KAAK,CAACa,OAAN,CAAc5D,QAAd,CAAJ,CACE,MAAOA,CAAAA,QAAP,CACF+C,KAAK,CAAG/C,QAAR,CACD,CAED,GAAIgE,CAAAA,KAAK,CAAGjB,KAAK,CAACkB,MAAlB,CAGA,GAAI9E,KAAK,CAACU,GAAN,GAAc,IAAd,EAAsBV,KAAK,CAACM,MAAN,GAAiB,IAA3C,CAAiD,CAC/C,GAAIN,KAAK,CAACQ,GAAV,CACE,GAAI2D,CAAAA,IAAI,CAAGP,KAAK,CAACO,IAAN,EAAX,CACF,GAAIhC,CAAAA,IAAI,CAAG,KAAKyC,UAAL,CACThB,KADS,CAET5D,KAAK,CAACc,QAAN,GAAmB,IAAnB,CAA0Bd,KAAK,CAACc,QAAhC,CAA2Cd,KAAK,CAACG,GAFxC,CAGTH,KAAK,CAACQ,GAHG,CAAX,CAKA,GAAIoD,KAAK,CAACa,OAAN,CAActC,IAAd,CAAJ,CACE,MAAOA,CAAAA,IAAP,CAEF,GAAInC,KAAK,CAACQ,GAAV,CACEuD,MAAM,CAAGH,KAAK,CAACmB,GAAN,CAAUZ,IAAV,CAAT,CADF,IAGEP,CAAAA,KAAK,CAAGzB,IAAR,CACH,CAED,GAAI0B,OAAO,EAAIA,OAAO,CAACmB,KAAnB,EAA4BhF,KAAK,CAACG,GAAN,GAAc,IAA9C,CACE0D,OAAO,CAACmB,KAAR,CAAcpB,KAAK,CAACqB,IAAN,EAAd,CAA4BJ,KAA5B,CAAmCjB,KAAK,CAACpB,MAAzC,CAAiD,QAAjD,EAEF,GAAIqB,OAAO,EAAIA,OAAO,CAACmB,KAAnB,EAA4BhF,KAAK,CAACG,GAAN,GAAc,IAA9C,CACE0D,OAAO,CAACmB,KAAR,CAAcpB,KAAK,CAACqB,IAAN,EAAd,CAA4BrB,KAAK,CAACkB,MAAlC,CAA0ClB,KAAK,CAACpB,MAAhD,CAAwD,SAAxD,EAGF,GAAIxC,KAAK,CAACQ,GAAV,CACEuD,MAAM,CAAGA,MAAT,CADF,IAEK,IAAI/D,KAAK,CAACM,MAAN,GAAiB,IAArB,CACHyD,MAAM,CAAG,KAAKK,cAAL,CAAoBpE,KAAK,CAACG,GAA1B,CAA+ByD,KAA/B,CAAsCC,OAAtC,CAAT,CADG,IAGHE,CAAAA,MAAM,CAAG,KAAKM,aAAL,CAAmBT,KAAnB,CAA0BC,OAA1B,CAAT,CAEF,GAAID,KAAK,CAACa,OAAN,CAAcV,MAAd,CAAJ,CACE,MAAOA,CAAAA,MAAP,CAGF,GAAI,CAAC/D,KAAK,CAACQ,GAAP,EAAcR,KAAK,CAACM,MAAN,GAAiB,IAA/B,EAAuCN,KAAK,CAACE,QAAN,GAAmB,IAA9D,CAAoE,CAClEF,KAAK,CAACE,QAAN,CAAeqB,OAAf,CAAuB,QAAS2D,CAAAA,cAAT,CAAwB5C,KAAxB,CAA+B,CAGpDA,KAAK,CAACoB,OAAN,CAAcE,KAAd,CAAqBC,OAArB,EACD,CAJD,EAKD,CAGD,GAAI7D,KAAK,CAACe,QAAN,GAAmBf,KAAK,CAACG,GAAN,GAAc,QAAd,EAA0BH,KAAK,CAACG,GAAN,GAAc,QAA3D,CAAJ,CAA0E,CACxE,GAAIgF,CAAAA,IAAI,CAAG,GAAI5F,CAAAA,aAAJ,CAAkBwE,MAAlB,CAAX,CACAA,MAAM,CAAG,KAAKqB,OAAL,CAAapF,KAAK,CAACe,QAAnB,CAA6B6C,KAAK,CAACyB,cAAN,CAAqB5E,GAAlD,EACJiD,OADI,CACIyB,IADJ,CACUtB,OADV,CAAT,CAED,CACF,CAGD,GAAI7D,KAAK,CAACS,GAAN,EAAauD,OAAjB,CACED,MAAM,CAAGH,KAAK,CAAC0B,WAAN,CAAkBZ,OAAlB,CAAT,CAGF,GAAI1E,KAAK,CAACY,GAAN,GAAc,IAAd,GAAuBmD,MAAM,GAAK,IAAX,EAAmBC,OAAO,GAAK,IAAtD,CAAJ,CACEJ,KAAK,CAAC2B,QAAN,CAAetB,OAAf,CAAwBjE,KAAK,CAACY,GAA9B,CAAmCmD,MAAnC,EADF,IAEK,IAAIE,OAAO,GAAK,IAAhB,CACHL,KAAK,CAAC4B,OAAN,CAAcvB,OAAd,EAEF,MAAOF,CAAAA,MAAP,CACD,CA5HD,CA8HAlE,IAAI,CAACuB,SAAL,CAAegD,cAAf,CAAgC,QAASqB,CAAAA,aAAT,CAAuBtF,GAAvB,CAA4ByD,KAA5B,CAAmCC,OAAnC,CAA4C,CAC1E,GAAI7D,CAAAA,KAAK,CAAG,KAAKC,UAAjB,CAEA,GAAIE,GAAG,GAAK,KAAR,EAAiBA,GAAG,GAAK,KAA7B,CACE,MAAO,KAAP,CACF,GAAIA,GAAG,GAAK,OAAR,EAAmBA,GAAG,GAAK,OAA/B,CACE,MAAO,MAAKuF,WAAL,CAAiB9B,KAAjB,CAAwBzD,GAAxB,CAA6BH,KAAK,CAACI,IAAN,CAAW,CAAX,CAA7B,CAA4CyD,OAA5C,CAAP,CADF,IAEK,IAAI,OAAO8B,IAAP,CAAYxF,GAAZ,CAAJ,CACH,MAAO,MAAKyF,UAAL,CAAgBhC,KAAhB,CAAuBzD,GAAvB,CAA4B0D,OAA5B,CAAP,CADG,IAEA,IAAI1D,GAAG,GAAK,OAAR,EAAmBH,KAAK,CAACI,IAA7B,CACH,MAAO,MAAKyF,YAAL,CAAkBjC,KAAlB,CAAyB5D,KAAK,CAACI,IAAN,CAAW,CAAX,CAAzB,CAAwCJ,KAAK,CAACI,IAAN,CAAW,CAAX,CAAxC,CAAuDyD,OAAvD,CAAP,CADG,IAEA,IAAI1D,GAAG,GAAK,OAAZ,CACH,MAAO,MAAK0F,YAAL,CAAkBjC,KAAlB,CAAyB,IAAzB,CAA+B,IAA/B,CAAqCC,OAArC,CAAP,CADG,IAEA,IAAI1D,GAAG,GAAK,SAAR,EAAqBA,GAAG,GAAK,SAAjC,CACH,MAAO,MAAK2F,WAAL,CAAiBlC,KAAjB,CAAwBzD,GAAxB,CAA6B0D,OAA7B,CAAP,CADG,IAEA,IAAI1D,GAAG,GAAK,OAAZ,CACH,MAAO,MAAK4F,WAAL,CAAiBnC,KAAjB,CAAwBC,OAAxB,CAAP,CADG,IAEA,IAAI1D,GAAG,GAAK,MAAZ,CACH,MAAO,MAAK6F,WAAL,CAAiBpC,KAAjB,CAAwBC,OAAxB,CAAP,CADG,IAEA,IAAI1D,GAAG,GAAK,SAAZ,CACH,MAAO,MAAKyF,UAAL,CAAgBhC,KAAhB,CAAuBzD,GAAvB,CAA4B0D,OAA5B,CAAP,CADG,IAEA,IAAI1D,GAAG,GAAK,KAAR,EAAiBA,GAAG,GAAK,MAA7B,CACH,MAAO,MAAK8F,UAAL,CAAgBrC,KAAhB,CAAuB5D,KAAK,CAACI,IAAN,EAAcJ,KAAK,CAACI,IAAN,CAAW,CAAX,CAArC,CAAoDyD,OAApD,CAAP,CAEF,GAAI7D,KAAK,CAACU,GAAN,GAAc,IAAlB,CAAwB,CACtB,MAAO,MAAK0E,OAAL,CAAapF,KAAK,CAACU,GAAnB,CAAwBkD,KAAK,CAACyB,cAAN,CAAqB5E,GAA7C,EACFiD,OADE,CACME,KADN,CACaC,OADb,CAAP,CAED,CAHD,IAGO,CACL,MAAOD,CAAAA,KAAK,CAACsC,KAAN,CAAY,gBAAkB/F,GAA9B,CAAP,CACD,CACF,CA9BD,CAgCAN,IAAI,CAACuB,SAAL,CAAegE,OAAf,CAAyB,QAASA,CAAAA,OAAT,CAAiBe,MAAjB,CAAyB1F,GAAzB,CAA8B,CAErD,GAAIT,CAAAA,KAAK,CAAG,KAAKC,UAAjB,CAEAD,KAAK,CAACW,UAAN,CAAmB,KAAKyF,IAAL,CAAUD,MAAV,CAAkB1F,GAAlB,CAAnB,CACAjB,MAAM,CAACQ,KAAK,CAACW,UAAN,CAAiBV,UAAjB,CAA4BF,MAA5B,GAAuC,IAAxC,CAAN,CACAC,KAAK,CAACW,UAAN,CAAmBX,KAAK,CAACW,UAAN,CAAiBV,UAAjB,CAA4BC,QAA5B,CAAqC,CAArC,CAAnB,CACA,GAAIF,KAAK,CAACc,QAAN,GAAmBd,KAAK,CAACW,UAAN,CAAiBV,UAAjB,CAA4Ba,QAAnD,CAA6D,CAC3Dd,KAAK,CAACW,UAAN,CAAmBX,KAAK,CAACW,UAAN,CAAiBU,KAAjB,EAAnB,CACArB,KAAK,CAACW,UAAN,CAAiBV,UAAjB,CAA4Ba,QAA5B,CAAuCd,KAAK,CAACc,QAA7C,CACD,CACD,MAAOd,CAAAA,KAAK,CAACW,UAAb,CACD,CAZD,CAcAd,IAAI,CAACuB,SAAL,CAAeiD,aAAf,CAA+B,QAASgC,CAAAA,YAAT,CAAsBzC,KAAtB,CAA6BC,OAA7B,CAAsC,CACnE,GAAI7D,CAAAA,KAAK,CAAG,KAAKC,UAAjB,CACA,GAAI8D,CAAAA,MAAM,CAAG,IAAb,CACA,GAAIuC,CAAAA,KAAK,CAAG,KAAZ,CAEAzD,MAAM,CAACC,IAAP,CAAY9C,KAAK,CAACM,MAAlB,EAA0BiG,IAA1B,CAA+B,SAAS3F,GAAT,CAAc,CAC3C,GAAIuD,CAAAA,IAAI,CAAGP,KAAK,CAACO,IAAN,EAAX,CACA,GAAIqC,CAAAA,IAAI,CAAGxG,KAAK,CAACM,MAAN,CAAaM,GAAb,CAAX,CACA,GAAI,CACF,GAAImC,CAAAA,KAAK,CAAGyD,IAAI,CAAC9C,OAAL,CAAaE,KAAb,CAAoBC,OAApB,CAAZ,CACA,GAAID,KAAK,CAACa,OAAN,CAAc1B,KAAd,CAAJ,CACE,MAAO,MAAP,CAEFgB,MAAM,CAAG,CAAE0C,IAAI,CAAE7F,GAAR,CAAamC,KAAK,CAAEA,KAApB,CAAT,CACAuD,KAAK,CAAG,IAAR,CACD,CAAC,MAAOhC,CAAP,CAAU,CACVV,KAAK,CAACW,OAAN,CAAcJ,IAAd,EACA,MAAO,MAAP,CACD,CACD,MAAO,KAAP,CACD,CAfD,CAeG,IAfH,EAiBA,GAAI,CAACmC,KAAL,CACE,MAAO1C,CAAAA,KAAK,CAACsC,KAAN,CAAY,oBAAZ,CAAP,CAEF,MAAOnC,CAAAA,MAAP,CACD,CA1BD,CAgCAlE,IAAI,CAACuB,SAAL,CAAesF,oBAAf,CAAsC,QAASC,CAAAA,mBAAT,CAA6BxB,IAA7B,CAAmC,CACvE,MAAO,IAAI7F,CAAAA,aAAJ,CAAkB6F,IAAlB,CAAwB,KAAKyB,QAA7B,CAAP,CACD,CAFD,CAIA/G,IAAI,CAACuB,SAAL,CAAeyF,OAAf,CAAyB,QAASC,CAAAA,MAAT,CAAgB3B,IAAhB,CAAsByB,QAAtB,CAAgC7G,MAAhC,CAAwC,CAC/D,GAAIC,CAAAA,KAAK,CAAG,KAAKC,UAAjB,CACA,GAAID,KAAK,CAAC,SAAD,CAAL,GAAqB,IAArB,EAA6BA,KAAK,CAAC,SAAD,CAAL,GAAqBmF,IAAtD,CACE,OAEF,GAAIpB,CAAAA,MAAM,CAAG,KAAKgD,YAAL,CAAkB5B,IAAlB,CAAwByB,QAAxB,CAAkC7G,MAAlC,CAAb,CACA,GAAIgE,MAAM,GAAKiD,SAAf,CACE,OAEF,GAAI,KAAKC,YAAL,CAAkBlD,MAAlB,CAA0B6C,QAA1B,CAAoC7G,MAApC,CAAJ,CACE,OAEF,MAAOgE,CAAAA,MAAP,CACD,CAbD,CAeAlE,IAAI,CAACuB,SAAL,CAAe2F,YAAf,CAA8B,QAASD,CAAAA,MAAT,CAAgB3B,IAAhB,CAAsByB,QAAtB,CAAgC7G,MAAhC,CAAwC,CACpE,GAAIC,CAAAA,KAAK,CAAG,KAAKC,UAAjB,CAGA,GAAID,KAAK,CAACD,MAAN,GAAiB,IAArB,CACE,MAAOC,CAAAA,KAAK,CAACE,QAAN,CAAe,CAAf,EAAkB2G,OAAlB,CAA0B1B,IAA1B,CAAgCyB,QAAQ,EAAI,GAAIxH,CAAAA,QAAJ,EAA5C,CAAP,CAEF,GAAI2E,CAAAA,MAAM,CAAG,IAAb,CAGA,KAAK6C,QAAL,CAAgBA,QAAhB,CAGA,GAAI5G,KAAK,CAACO,QAAN,EAAkB4E,IAAI,GAAK6B,SAA/B,CAA0C,CACxC,GAAIhH,KAAK,CAAC,SAAD,CAAL,GAAqB,IAAzB,CACEmF,IAAI,CAAGnF,KAAK,CAAC,SAAD,CAAZ,CADF,IAGE,QACH,CAGD,GAAIkH,CAAAA,OAAO,CAAG,IAAd,CACA,GAAIC,CAAAA,SAAS,CAAG,KAAhB,CACA,GAAInH,KAAK,CAACQ,GAAV,CAAe,CAEbuD,MAAM,CAAG,KAAK2C,oBAAL,CAA0BvB,IAA1B,CAAT,CACD,CAHD,IAGO,IAAInF,KAAK,CAACM,MAAV,CAAkB,CACvByD,MAAM,CAAG,KAAKqD,aAAL,CAAmBjC,IAAnB,CAAyByB,QAAzB,CAAT,CACD,CAFM,IAEA,IAAI5G,KAAK,CAACe,QAAV,CAAoB,CACzBmG,OAAO,CAAG,KAAK9B,OAAL,CAAapF,KAAK,CAACe,QAAnB,CAA6BhB,MAA7B,EAAqC8G,OAArC,CAA6C1B,IAA7C,CAAmDyB,QAAnD,CAAV,CACAO,SAAS,CAAG,IAAZ,CACD,CAHM,IAGA,IAAInH,KAAK,CAACE,QAAV,CAAoB,CACzBgH,OAAO,CAAGlH,KAAK,CAACE,QAAN,CAAe0C,GAAf,CAAmB,SAASN,KAAT,CAAgB,CAC3C,GAAIA,KAAK,CAACrC,UAAN,CAAiBE,GAAjB,GAAyB,OAA7B,CACE,MAAOmC,CAAAA,KAAK,CAACuE,OAAN,CAAc,IAAd,CAAoBD,QAApB,CAA8BzB,IAA9B,CAAP,CAEF,GAAI7C,KAAK,CAACrC,UAAN,CAAiBW,GAAjB,GAAyB,IAA7B,CACE,MAAOgG,CAAAA,QAAQ,CAACV,KAAT,CAAe,yBAAf,CAAP,CACF,GAAIjC,CAAAA,OAAO,CAAG2C,QAAQ,CAAC1C,QAAT,CAAkB5B,KAAK,CAACrC,UAAN,CAAiBW,GAAnC,CAAd,CAEA,GAAI,MAAOuE,CAAAA,IAAP,GAAgB,QAApB,CACE,MAAOyB,CAAAA,QAAQ,CAACV,KAAT,CAAe,yCAAf,CAAP,CAEF,GAAIzE,CAAAA,GAAG,CAAGa,KAAK,CAACuE,OAAN,CAAc1B,IAAI,CAAC7C,KAAK,CAACrC,UAAN,CAAiBW,GAAlB,CAAlB,CAA0CgG,QAA1C,CAAoDzB,IAApD,CAAV,CACAyB,QAAQ,CAACrB,QAAT,CAAkBtB,OAAlB,EAEA,MAAOxC,CAAAA,GAAP,CACD,CAfS,CAeP,IAfO,EAeDY,MAfC,CAeM,SAASC,KAAT,CAAgB,CAC9B,MAAOA,CAAAA,KAAP,CACD,CAjBS,CAAV,CAkBA4E,OAAO,CAAG,KAAKR,oBAAL,CAA0BQ,OAA1B,CAAV,CACD,CApBM,IAoBA,CACL,GAAIlH,KAAK,CAACG,GAAN,GAAc,OAAd,EAAyBH,KAAK,CAACG,GAAN,GAAc,OAA3C,CAAoD,CAElD,GAAI,EAAEH,KAAK,CAACI,IAAN,EAAcJ,KAAK,CAACI,IAAN,CAAWoC,MAAX,GAAsB,CAAtC,CAAJ,CACE,MAAOoE,CAAAA,QAAQ,CAACV,KAAT,CAAe,uBAAyBlG,KAAK,CAACG,GAA9C,CAAP,CAEF,GAAI,CAACgD,KAAK,CAACkE,OAAN,CAAclC,IAAd,CAAL,CACE,MAAOyB,CAAAA,QAAQ,CAACV,KAAT,CAAe,oCAAf,CAAP,CAEF,GAAI5D,CAAAA,KAAK,CAAG,KAAKjB,KAAL,EAAZ,CACAiB,KAAK,CAACrC,UAAN,CAAiBa,QAAjB,CAA4B,IAA5B,CACAoG,OAAO,CAAG,KAAKR,oBAAL,CAA0BvB,IAAI,CAACvC,GAAL,CAAS,SAASS,IAAT,CAAe,CAC1D,GAAIrD,CAAAA,KAAK,CAAG,KAAKC,UAAjB,CAEA,MAAO,MAAKmF,OAAL,CAAapF,KAAK,CAACI,IAAN,CAAW,CAAX,CAAb,CAA4B+E,IAA5B,EAAkC0B,OAAlC,CAA0CxD,IAA1C,CAAgDuD,QAAhD,CAAP,CACD,CAJmC,CAIjCtE,KAJiC,CAA1B,CAAV,CAKD,CAfD,IAeO,IAAItC,KAAK,CAACU,GAAN,GAAc,IAAlB,CAAwB,CAC7BqD,MAAM,CAAG,KAAKqB,OAAL,CAAapF,KAAK,CAACU,GAAnB,CAAwBX,MAAxB,EAAgC8G,OAAhC,CAAwC1B,IAAxC,CAA8CyB,QAA9C,CAAT,CACD,CAFM,IAEA,CACLM,OAAO,CAAG,KAAKI,gBAAL,CAAsBtH,KAAK,CAACG,GAA5B,CAAiCgF,IAAjC,CAAV,CACAgC,SAAS,CAAG,IAAZ,CACD,CACF,CAGD,GAAIpD,CAAAA,MAAJ,CACA,GAAI,CAAC/D,KAAK,CAACQ,GAAP,EAAcR,KAAK,CAACM,MAAN,GAAiB,IAAnC,CAAyC,CACvC,GAAIH,CAAAA,GAAG,CAAGH,KAAK,CAACc,QAAN,GAAmB,IAAnB,CAA0Bd,KAAK,CAACc,QAAhC,CAA2Cd,KAAK,CAACG,GAA3D,CACA,GAAIoH,CAAAA,GAAG,CAAGvH,KAAK,CAACc,QAAN,GAAmB,IAAnB,CAA0B,WAA1B,CAAwC,SAAlD,CAEA,GAAIX,GAAG,GAAK,IAAZ,CAAkB,CAChB,GAAIH,KAAK,CAACU,GAAN,GAAc,IAAlB,CACEkG,QAAQ,CAACV,KAAT,CAAe,sCAAf,EACH,CAHD,IAGO,CACL,GAAIlG,KAAK,CAACU,GAAN,GAAc,IAAlB,CACEqD,MAAM,CAAG,KAAKyD,gBAAL,CAAsBrH,GAAtB,CAA2BgH,SAA3B,CAAsCI,GAAtC,CAA2CL,OAA3C,CAAT,CACH,CACF,CAGD,GAAIlH,KAAK,CAACa,QAAN,GAAmB,IAAvB,CACEkD,MAAM,CAAG,KAAKyD,gBAAL,CAAsBxH,KAAK,CAACa,QAA5B,CAAsC,KAAtC,CAA6C,SAA7C,CAAwDkD,MAAxD,CAAT,CAEF,MAAOA,CAAAA,MAAP,CACD,CA/FD,CAiGAlE,IAAI,CAACuB,SAAL,CAAegG,aAAf,CAA+B,QAASK,CAAAA,YAAT,CAAsBtC,IAAtB,CAA4ByB,QAA5B,CAAsC,CACnE,GAAI5G,CAAAA,KAAK,CAAG,KAAKC,UAAjB,CAEA,GAAIuG,CAAAA,IAAI,CAAGxG,KAAK,CAACM,MAAN,CAAa6E,IAAI,CAACsB,IAAlB,CAAX,CACA,GAAI,CAACD,IAAL,CAAW,CACThH,MAAM,CACF,KADE,CAEF2F,IAAI,CAACsB,IAAL,CAAY,gBAAZ,CACIiB,IAAI,CAACC,SAAL,CAAe9E,MAAM,CAACC,IAAP,CAAY9C,KAAK,CAACM,MAAlB,CAAf,CAHF,CAAN,CAID,CACD,MAAOkG,CAAAA,IAAI,CAACK,OAAL,CAAa1B,IAAI,CAACpC,KAAlB,CAAyB6D,QAAzB,CAAP,CACD,CAXD,CAaA/G,IAAI,CAACuB,SAAL,CAAekG,gBAAf,CAAkC,QAASM,CAAAA,eAAT,CAAyBzH,GAAzB,CAA8BgF,IAA9B,CAAoC,CACpE,GAAInF,CAAAA,KAAK,CAAG,KAAKC,UAAjB,CAEA,GAAI,OAAO0F,IAAP,CAAYxF,GAAZ,CAAJ,CACE,MAAO,MAAK0H,UAAL,CAAgB1C,IAAhB,CAAsBhF,GAAtB,CAAP,CADF,IAEK,IAAIA,GAAG,GAAK,OAAR,EAAmBH,KAAK,CAACI,IAA7B,CACH,MAAO,MAAK0H,YAAL,CAAkB3C,IAAlB,CAAwBnF,KAAK,CAACK,WAAN,CAAkB,CAAlB,CAAxB,CAA8CL,KAAK,CAACI,IAAN,CAAW,CAAX,CAA9C,CAAP,CADG,IAEA,IAAID,GAAG,GAAK,OAAZ,CACH,MAAO,MAAK2H,YAAL,CAAkB3C,IAAlB,CAAwB,IAAxB,CAA8B,IAA9B,CAAP,CADG,IAEA,IAAIhF,GAAG,GAAK,SAAR,EAAqBA,GAAG,GAAK,SAAjC,CACH,MAAO,MAAK4H,WAAL,CAAiB5C,IAAjB,CAAuBhF,GAAvB,CAAP,CADG,IAEA,IAAIA,GAAG,GAAK,OAAZ,CACH,MAAO,MAAK6H,WAAL,EAAP,CADG,IAEA,IAAI7H,GAAG,GAAK,KAAR,EAAiBA,GAAG,GAAK,MAA7B,CACH,MAAO,MAAK8H,UAAL,CAAgB9C,IAAhB,CAAsBnF,KAAK,CAACI,IAAN,EAAcJ,KAAK,CAACK,WAAN,CAAkB,CAAlB,CAApC,CAAP,CADG,IAEA,IAAIF,GAAG,GAAK,MAAZ,CACH,MAAO,MAAK+H,WAAL,CAAiB/C,IAAjB,CAAP,CADG,IAEA,IAAIhF,GAAG,GAAK,SAAZ,CACH,MAAO,MAAK0H,UAAL,CAAgB1C,IAAhB,CAAsBhF,GAAtB,CAAP,CADG,IAGH,MAAM,IAAI8C,CAAAA,KAAJ,CAAU,oBAAsB9C,GAAhC,CAAN,CACH,CArBD,CAuBAN,IAAI,CAACuB,SAAL,CAAe+G,SAAf,CAA2B,QAASC,CAAAA,QAAT,CAAkBC,GAAlB,CAAuB,CAChD,MAAO,aAAY1C,IAAZ,CAAiB0C,GAAjB,CAAP,CACD,CAFD,CAIAxI,IAAI,CAACuB,SAAL,CAAekH,WAAf,CAA6B,QAASC,CAAAA,UAAT,CAAoBF,GAApB,CAAyB,CACpD,MAAO,qCAAoC1C,IAApC,CAAyC0C,GAAzC,CAAP,CACD,CAFD","sourcesContent":["var Reporter = require('../base').Reporter;\nvar EncoderBuffer = require('../base').EncoderBuffer;\nvar DecoderBuffer = require('../base').DecoderBuffer;\nvar assert = require('minimalistic-assert');\n\n// Supported tags\nvar tags = [\n  'seq', 'seqof', 'set', 'setof', 'objid', 'bool',\n  'gentime', 'utctime', 'null_', 'enum', 'int', 'objDesc',\n  'bitstr', 'bmpstr', 'charstr', 'genstr', 'graphstr', 'ia5str', 'iso646str',\n  'numstr', 'octstr', 'printstr', 't61str', 'unistr', 'utf8str', 'videostr'\n];\n\n// Public methods list\nvar methods = [\n  'key', 'obj', 'use', 'optional', 'explicit', 'implicit', 'def', 'choice',\n  'any', 'contains'\n].concat(tags);\n\n// Overrided methods list\nvar overrided = [\n  '_peekTag', '_decodeTag', '_use',\n  '_decodeStr', '_decodeObjid', '_decodeTime',\n  '_decodeNull', '_decodeInt', '_decodeBool', '_decodeList',\n\n  '_encodeComposite', '_encodeStr', '_encodeObjid', '_encodeTime',\n  '_encodeNull', '_encodeInt', '_encodeBool'\n];\n\nfunction Node(enc, parent) {\n  var state = {};\n  this._baseState = state;\n\n  state.enc = enc;\n\n  state.parent = parent || null;\n  state.children = null;\n\n  // State\n  state.tag = null;\n  state.args = null;\n  state.reverseArgs = null;\n  state.choice = null;\n  state.optional = false;\n  state.any = false;\n  state.obj = false;\n  state.use = null;\n  state.useDecoder = null;\n  state.key = null;\n  state['default'] = null;\n  state.explicit = null;\n  state.implicit = null;\n  state.contains = null;\n\n  // Should create new instance on each method\n  if (!state.parent) {\n    state.children = [];\n    this._wrap();\n  }\n}\nmodule.exports = Node;\n\nvar stateProps = [\n  'enc', 'parent', 'children', 'tag', 'args', 'reverseArgs', 'choice',\n  'optional', 'any', 'obj', 'use', 'alteredUse', 'key', 'default', 'explicit',\n  'implicit', 'contains'\n];\n\nNode.prototype.clone = function clone() {\n  var state = this._baseState;\n  var cstate = {};\n  stateProps.forEach(function(prop) {\n    cstate[prop] = state[prop];\n  });\n  var res = new this.constructor(cstate.parent);\n  res._baseState = cstate;\n  return res;\n};\n\nNode.prototype._wrap = function wrap() {\n  var state = this._baseState;\n  methods.forEach(function(method) {\n    this[method] = function _wrappedMethod() {\n      var clone = new this.constructor(this);\n      state.children.push(clone);\n      return clone[method].apply(clone, arguments);\n    };\n  }, this);\n};\n\nNode.prototype._init = function init(body) {\n  var state = this._baseState;\n\n  assert(state.parent === null);\n  body.call(this);\n\n  // Filter children\n  state.children = state.children.filter(function(child) {\n    return child._baseState.parent === this;\n  }, this);\n  assert.equal(state.children.length, 1, 'Root node can have only one child');\n};\n\nNode.prototype._useArgs = function useArgs(args) {\n  var state = this._baseState;\n\n  // Filter children and args\n  var children = args.filter(function(arg) {\n    return arg instanceof this.constructor;\n  }, this);\n  args = args.filter(function(arg) {\n    return !(arg instanceof this.constructor);\n  }, this);\n\n  if (children.length !== 0) {\n    assert(state.children === null);\n    state.children = children;\n\n    // Replace parent to maintain backward link\n    children.forEach(function(child) {\n      child._baseState.parent = this;\n    }, this);\n  }\n  if (args.length !== 0) {\n    assert(state.args === null);\n    state.args = args;\n    state.reverseArgs = args.map(function(arg) {\n      if (typeof arg !== 'object' || arg.constructor !== Object)\n        return arg;\n\n      var res = {};\n      Object.keys(arg).forEach(function(key) {\n        if (key == (key | 0))\n          key |= 0;\n        var value = arg[key];\n        res[value] = key;\n      });\n      return res;\n    });\n  }\n};\n\n//\n// Overrided methods\n//\n\noverrided.forEach(function(method) {\n  Node.prototype[method] = function _overrided() {\n    var state = this._baseState;\n    throw new Error(method + ' not implemented for encoding: ' + state.enc);\n  };\n});\n\n//\n// Public methods\n//\n\ntags.forEach(function(tag) {\n  Node.prototype[tag] = function _tagMethod() {\n    var state = this._baseState;\n    var args = Array.prototype.slice.call(arguments);\n\n    assert(state.tag === null);\n    state.tag = tag;\n\n    this._useArgs(args);\n\n    return this;\n  };\n});\n\nNode.prototype.use = function use(item) {\n  assert(item);\n  var state = this._baseState;\n\n  assert(state.use === null);\n  state.use = item;\n\n  return this;\n};\n\nNode.prototype.optional = function optional() {\n  var state = this._baseState;\n\n  state.optional = true;\n\n  return this;\n};\n\nNode.prototype.def = function def(val) {\n  var state = this._baseState;\n\n  assert(state['default'] === null);\n  state['default'] = val;\n  state.optional = true;\n\n  return this;\n};\n\nNode.prototype.explicit = function explicit(num) {\n  var state = this._baseState;\n\n  assert(state.explicit === null && state.implicit === null);\n  state.explicit = num;\n\n  return this;\n};\n\nNode.prototype.implicit = function implicit(num) {\n  var state = this._baseState;\n\n  assert(state.explicit === null && state.implicit === null);\n  state.implicit = num;\n\n  return this;\n};\n\nNode.prototype.obj = function obj() {\n  var state = this._baseState;\n  var args = Array.prototype.slice.call(arguments);\n\n  state.obj = true;\n\n  if (args.length !== 0)\n    this._useArgs(args);\n\n  return this;\n};\n\nNode.prototype.key = function key(newKey) {\n  var state = this._baseState;\n\n  assert(state.key === null);\n  state.key = newKey;\n\n  return this;\n};\n\nNode.prototype.any = function any() {\n  var state = this._baseState;\n\n  state.any = true;\n\n  return this;\n};\n\nNode.prototype.choice = function choice(obj) {\n  var state = this._baseState;\n\n  assert(state.choice === null);\n  state.choice = obj;\n  this._useArgs(Object.keys(obj).map(function(key) {\n    return obj[key];\n  }));\n\n  return this;\n};\n\nNode.prototype.contains = function contains(item) {\n  var state = this._baseState;\n\n  assert(state.use === null);\n  state.contains = item;\n\n  return this;\n};\n\n//\n// Decoding\n//\n\nNode.prototype._decode = function decode(input, options) {\n  var state = this._baseState;\n\n  // Decode root node\n  if (state.parent === null)\n    return input.wrapResult(state.children[0]._decode(input, options));\n\n  var result = state['default'];\n  var present = true;\n\n  var prevKey = null;\n  if (state.key !== null)\n    prevKey = input.enterKey(state.key);\n\n  // Check if tag is there\n  if (state.optional) {\n    var tag = null;\n    if (state.explicit !== null)\n      tag = state.explicit;\n    else if (state.implicit !== null)\n      tag = state.implicit;\n    else if (state.tag !== null)\n      tag = state.tag;\n\n    if (tag === null && !state.any) {\n      // Trial and Error\n      var save = input.save();\n      try {\n        if (state.choice === null)\n          this._decodeGeneric(state.tag, input, options);\n        else\n          this._decodeChoice(input, options);\n        present = true;\n      } catch (e) {\n        present = false;\n      }\n      input.restore(save);\n    } else {\n      present = this._peekTag(input, tag, state.any);\n\n      if (input.isError(present))\n        return present;\n    }\n  }\n\n  // Push object on stack\n  var prevObj;\n  if (state.obj && present)\n    prevObj = input.enterObject();\n\n  if (present) {\n    // Unwrap explicit values\n    if (state.explicit !== null) {\n      var explicit = this._decodeTag(input, state.explicit);\n      if (input.isError(explicit))\n        return explicit;\n      input = explicit;\n    }\n\n    var start = input.offset;\n\n    // Unwrap implicit and normal values\n    if (state.use === null && state.choice === null) {\n      if (state.any)\n        var save = input.save();\n      var body = this._decodeTag(\n        input,\n        state.implicit !== null ? state.implicit : state.tag,\n        state.any\n      );\n      if (input.isError(body))\n        return body;\n\n      if (state.any)\n        result = input.raw(save);\n      else\n        input = body;\n    }\n\n    if (options && options.track && state.tag !== null)\n      options.track(input.path(), start, input.length, 'tagged');\n\n    if (options && options.track && state.tag !== null)\n      options.track(input.path(), input.offset, input.length, 'content');\n\n    // Select proper method for tag\n    if (state.any)\n      result = result;\n    else if (state.choice === null)\n      result = this._decodeGeneric(state.tag, input, options);\n    else\n      result = this._decodeChoice(input, options);\n\n    if (input.isError(result))\n      return result;\n\n    // Decode children\n    if (!state.any && state.choice === null && state.children !== null) {\n      state.children.forEach(function decodeChildren(child) {\n        // NOTE: We are ignoring errors here, to let parser continue with other\n        // parts of encoded data\n        child._decode(input, options);\n      });\n    }\n\n    // Decode contained/encoded by schema, only in bit or octet strings\n    if (state.contains && (state.tag === 'octstr' || state.tag === 'bitstr')) {\n      var data = new DecoderBuffer(result);\n      result = this._getUse(state.contains, input._reporterState.obj)\n          ._decode(data, options);\n    }\n  }\n\n  // Pop object\n  if (state.obj && present)\n    result = input.leaveObject(prevObj);\n\n  // Set key\n  if (state.key !== null && (result !== null || present === true))\n    input.leaveKey(prevKey, state.key, result);\n  else if (prevKey !== null)\n    input.exitKey(prevKey);\n\n  return result;\n};\n\nNode.prototype._decodeGeneric = function decodeGeneric(tag, input, options) {\n  var state = this._baseState;\n\n  if (tag === 'seq' || tag === 'set')\n    return null;\n  if (tag === 'seqof' || tag === 'setof')\n    return this._decodeList(input, tag, state.args[0], options);\n  else if (/str$/.test(tag))\n    return this._decodeStr(input, tag, options);\n  else if (tag === 'objid' && state.args)\n    return this._decodeObjid(input, state.args[0], state.args[1], options);\n  else if (tag === 'objid')\n    return this._decodeObjid(input, null, null, options);\n  else if (tag === 'gentime' || tag === 'utctime')\n    return this._decodeTime(input, tag, options);\n  else if (tag === 'null_')\n    return this._decodeNull(input, options);\n  else if (tag === 'bool')\n    return this._decodeBool(input, options);\n  else if (tag === 'objDesc')\n    return this._decodeStr(input, tag, options);\n  else if (tag === 'int' || tag === 'enum')\n    return this._decodeInt(input, state.args && state.args[0], options);\n\n  if (state.use !== null) {\n    return this._getUse(state.use, input._reporterState.obj)\n        ._decode(input, options);\n  } else {\n    return input.error('unknown tag: ' + tag);\n  }\n};\n\nNode.prototype._getUse = function _getUse(entity, obj) {\n\n  var state = this._baseState;\n  // Create altered use decoder if implicit is set\n  state.useDecoder = this._use(entity, obj);\n  assert(state.useDecoder._baseState.parent === null);\n  state.useDecoder = state.useDecoder._baseState.children[0];\n  if (state.implicit !== state.useDecoder._baseState.implicit) {\n    state.useDecoder = state.useDecoder.clone();\n    state.useDecoder._baseState.implicit = state.implicit;\n  }\n  return state.useDecoder;\n};\n\nNode.prototype._decodeChoice = function decodeChoice(input, options) {\n  var state = this._baseState;\n  var result = null;\n  var match = false;\n\n  Object.keys(state.choice).some(function(key) {\n    var save = input.save();\n    var node = state.choice[key];\n    try {\n      var value = node._decode(input, options);\n      if (input.isError(value))\n        return false;\n\n      result = { type: key, value: value };\n      match = true;\n    } catch (e) {\n      input.restore(save);\n      return false;\n    }\n    return true;\n  }, this);\n\n  if (!match)\n    return input.error('Choice not matched');\n\n  return result;\n};\n\n//\n// Encoding\n//\n\nNode.prototype._createEncoderBuffer = function createEncoderBuffer(data) {\n  return new EncoderBuffer(data, this.reporter);\n};\n\nNode.prototype._encode = function encode(data, reporter, parent) {\n  var state = this._baseState;\n  if (state['default'] !== null && state['default'] === data)\n    return;\n\n  var result = this._encodeValue(data, reporter, parent);\n  if (result === undefined)\n    return;\n\n  if (this._skipDefault(result, reporter, parent))\n    return;\n\n  return result;\n};\n\nNode.prototype._encodeValue = function encode(data, reporter, parent) {\n  var state = this._baseState;\n\n  // Decode root node\n  if (state.parent === null)\n    return state.children[0]._encode(data, reporter || new Reporter());\n\n  var result = null;\n\n  // Set reporter to share it with a child class\n  this.reporter = reporter;\n\n  // Check if data is there\n  if (state.optional && data === undefined) {\n    if (state['default'] !== null)\n      data = state['default']\n    else\n      return;\n  }\n\n  // Encode children first\n  var content = null;\n  var primitive = false;\n  if (state.any) {\n    // Anything that was given is translated to buffer\n    result = this._createEncoderBuffer(data);\n  } else if (state.choice) {\n    result = this._encodeChoice(data, reporter);\n  } else if (state.contains) {\n    content = this._getUse(state.contains, parent)._encode(data, reporter);\n    primitive = true;\n  } else if (state.children) {\n    content = state.children.map(function(child) {\n      if (child._baseState.tag === 'null_')\n        return child._encode(null, reporter, data);\n\n      if (child._baseState.key === null)\n        return reporter.error('Child should have a key');\n      var prevKey = reporter.enterKey(child._baseState.key);\n\n      if (typeof data !== 'object')\n        return reporter.error('Child expected, but input is not object');\n\n      var res = child._encode(data[child._baseState.key], reporter, data);\n      reporter.leaveKey(prevKey);\n\n      return res;\n    }, this).filter(function(child) {\n      return child;\n    });\n    content = this._createEncoderBuffer(content);\n  } else {\n    if (state.tag === 'seqof' || state.tag === 'setof') {\n      // TODO(indutny): this should be thrown on DSL level\n      if (!(state.args && state.args.length === 1))\n        return reporter.error('Too many args for : ' + state.tag);\n\n      if (!Array.isArray(data))\n        return reporter.error('seqof/setof, but data is not Array');\n\n      var child = this.clone();\n      child._baseState.implicit = null;\n      content = this._createEncoderBuffer(data.map(function(item) {\n        var state = this._baseState;\n\n        return this._getUse(state.args[0], data)._encode(item, reporter);\n      }, child));\n    } else if (state.use !== null) {\n      result = this._getUse(state.use, parent)._encode(data, reporter);\n    } else {\n      content = this._encodePrimitive(state.tag, data);\n      primitive = true;\n    }\n  }\n\n  // Encode data itself\n  var result;\n  if (!state.any && state.choice === null) {\n    var tag = state.implicit !== null ? state.implicit : state.tag;\n    var cls = state.implicit === null ? 'universal' : 'context';\n\n    if (tag === null) {\n      if (state.use === null)\n        reporter.error('Tag could be omitted only for .use()');\n    } else {\n      if (state.use === null)\n        result = this._encodeComposite(tag, primitive, cls, content);\n    }\n  }\n\n  // Wrap in explicit\n  if (state.explicit !== null)\n    result = this._encodeComposite(state.explicit, false, 'context', result);\n\n  return result;\n};\n\nNode.prototype._encodeChoice = function encodeChoice(data, reporter) {\n  var state = this._baseState;\n\n  var node = state.choice[data.type];\n  if (!node) {\n    assert(\n        false,\n        data.type + ' not found in ' +\n            JSON.stringify(Object.keys(state.choice)));\n  }\n  return node._encode(data.value, reporter);\n};\n\nNode.prototype._encodePrimitive = function encodePrimitive(tag, data) {\n  var state = this._baseState;\n\n  if (/str$/.test(tag))\n    return this._encodeStr(data, tag);\n  else if (tag === 'objid' && state.args)\n    return this._encodeObjid(data, state.reverseArgs[0], state.args[1]);\n  else if (tag === 'objid')\n    return this._encodeObjid(data, null, null);\n  else if (tag === 'gentime' || tag === 'utctime')\n    return this._encodeTime(data, tag);\n  else if (tag === 'null_')\n    return this._encodeNull();\n  else if (tag === 'int' || tag === 'enum')\n    return this._encodeInt(data, state.args && state.reverseArgs[0]);\n  else if (tag === 'bool')\n    return this._encodeBool(data);\n  else if (tag === 'objDesc')\n    return this._encodeStr(data, tag);\n  else\n    throw new Error('Unsupported tag: ' + tag);\n};\n\nNode.prototype._isNumstr = function isNumstr(str) {\n  return /^[0-9 ]*$/.test(str);\n};\n\nNode.prototype._isPrintstr = function isPrintstr(str) {\n  return /^[A-Za-z0-9 '\\(\\)\\+,\\-\\.\\/:=\\?]*$/.test(str);\n};\n"]},"metadata":{},"sourceType":"script"}