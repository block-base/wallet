{"ast":null,"code":"var bn=require('bn.js');var brorand=require('brorand');function MillerRabin(rand){this.rand=rand||new brorand.Rand();}module.exports=MillerRabin;MillerRabin.create=function create(rand){return new MillerRabin(rand);};MillerRabin.prototype._randbelow=function _randbelow(n){var len=n.bitLength();var min_bytes=Math.ceil(len/8);do{var a=new bn(this.rand.generate(min_bytes));}while(a.cmp(n)>=0);return a;};MillerRabin.prototype._randrange=function _randrange(start,stop){var size=stop.sub(start);return start.add(this._randbelow(size));};MillerRabin.prototype.test=function test(n,k,cb){var len=n.bitLength();var red=bn.mont(n);var rone=new bn(1).toRed(red);if(!k)k=Math.max(1,len/48|0);var n1=n.subn(1);for(var s=0;!n1.testn(s);s++){}var d=n.shrn(s);var rn1=n1.toRed(red);var prime=true;for(;k>0;k--){var a=this._randrange(new bn(2),n1);if(cb)cb(a);var x=a.toRed(red).redPow(d);if(x.cmp(rone)===0||x.cmp(rn1)===0)continue;for(var i=1;i<s;i++){x=x.redSqr();if(x.cmp(rone)===0)return false;if(x.cmp(rn1)===0)break;}if(i===s)return false;}return prime;};MillerRabin.prototype.getDivisor=function getDivisor(n,k){var len=n.bitLength();var red=bn.mont(n);var rone=new bn(1).toRed(red);if(!k)k=Math.max(1,len/48|0);var n1=n.subn(1);for(var s=0;!n1.testn(s);s++){}var d=n.shrn(s);var rn1=n1.toRed(red);for(;k>0;k--){var a=this._randrange(new bn(2),n1);var g=n.gcd(a);if(g.cmpn(1)!==0)return g;var x=a.toRed(red).redPow(d);if(x.cmp(rone)===0||x.cmp(rn1)===0)continue;for(var i=1;i<s;i++){x=x.redSqr();if(x.cmp(rone)===0)return x.fromRed().subn(1).gcd(n);if(x.cmp(rn1)===0)break;}if(i===s){x=x.redSqr();return x.fromRed().subn(1).gcd(n);}}return false;};","map":{"version":3,"sources":["/Users/naohirofujie/.anyenv/envs/nodenv/versions/14.5.0/lib/node_modules/expo-cli/node_modules/miller-rabin/lib/mr.js"],"names":["bn","require","brorand","MillerRabin","rand","Rand","module","exports","create","prototype","_randbelow","n","len","bitLength","min_bytes","Math","ceil","a","generate","cmp","_randrange","start","stop","size","sub","add","test","k","cb","red","mont","rone","toRed","max","n1","subn","s","testn","d","shrn","rn1","prime","x","redPow","i","redSqr","getDivisor","g","gcd","cmpn","fromRed"],"mappings":"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","sourcesContent":["var bn = require('bn.js');\nvar brorand = require('brorand');\n\nfunction MillerRabin(rand) {\n  this.rand = rand || new brorand.Rand();\n}\nmodule.exports = MillerRabin;\n\nMillerRabin.create = function create(rand) {\n  return new MillerRabin(rand);\n};\n\nMillerRabin.prototype._randbelow = function _randbelow(n) {\n  var len = n.bitLength();\n  var min_bytes = Math.ceil(len / 8);\n\n  // Generage random bytes until a number less than n is found.\n  // This ensures that 0..n-1 have an equal probability of being selected.\n  do\n    var a = new bn(this.rand.generate(min_bytes));\n  while (a.cmp(n) >= 0);\n\n  return a;\n};\n\nMillerRabin.prototype._randrange = function _randrange(start, stop) {\n  // Generate a random number greater than or equal to start and less than stop.\n  var size = stop.sub(start);\n  return start.add(this._randbelow(size));\n};\n\nMillerRabin.prototype.test = function test(n, k, cb) {\n  var len = n.bitLength();\n  var red = bn.mont(n);\n  var rone = new bn(1).toRed(red);\n\n  if (!k)\n    k = Math.max(1, (len / 48) | 0);\n\n  // Find d and s, (n - 1) = (2 ^ s) * d;\n  var n1 = n.subn(1);\n  for (var s = 0; !n1.testn(s); s++) {}\n  var d = n.shrn(s);\n\n  var rn1 = n1.toRed(red);\n\n  var prime = true;\n  for (; k > 0; k--) {\n    var a = this._randrange(new bn(2), n1);\n    if (cb)\n      cb(a);\n\n    var x = a.toRed(red).redPow(d);\n    if (x.cmp(rone) === 0 || x.cmp(rn1) === 0)\n      continue;\n\n    for (var i = 1; i < s; i++) {\n      x = x.redSqr();\n\n      if (x.cmp(rone) === 0)\n        return false;\n      if (x.cmp(rn1) === 0)\n        break;\n    }\n\n    if (i === s)\n      return false;\n  }\n\n  return prime;\n};\n\nMillerRabin.prototype.getDivisor = function getDivisor(n, k) {\n  var len = n.bitLength();\n  var red = bn.mont(n);\n  var rone = new bn(1).toRed(red);\n\n  if (!k)\n    k = Math.max(1, (len / 48) | 0);\n\n  // Find d and s, (n - 1) = (2 ^ s) * d;\n  var n1 = n.subn(1);\n  for (var s = 0; !n1.testn(s); s++) {}\n  var d = n.shrn(s);\n\n  var rn1 = n1.toRed(red);\n\n  for (; k > 0; k--) {\n    var a = this._randrange(new bn(2), n1);\n\n    var g = n.gcd(a);\n    if (g.cmpn(1) !== 0)\n      return g;\n\n    var x = a.toRed(red).redPow(d);\n    if (x.cmp(rone) === 0 || x.cmp(rn1) === 0)\n      continue;\n\n    for (var i = 1; i < s; i++) {\n      x = x.redSqr();\n\n      if (x.cmp(rone) === 0)\n        return x.fromRed().subn(1).gcd(n);\n      if (x.cmp(rn1) === 0)\n        break;\n    }\n\n    if (i === s) {\n      x = x.redSqr();\n      return x.fromRed().subn(1).gcd(n);\n    }\n  }\n\n  return false;\n};\n"]},"metadata":{},"sourceType":"script"}